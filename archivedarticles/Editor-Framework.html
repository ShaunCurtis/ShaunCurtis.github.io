<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building an Editor Framework | Cold Elm Coders</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.757cca11.css" as="style"><link rel="preload" href="/assets/js/app.e7504274.js" as="script"><link rel="preload" href="/assets/js/3.f3d70fce.js" as="script"><link rel="preload" href="/assets/js/35.dd6a5277.js" as="script"><link rel="prefetch" href="/assets/js/1.dd2e798d.js"><link rel="prefetch" href="/assets/js/10.62cd9054.js"><link rel="prefetch" href="/assets/js/11.7ef2f0cc.js"><link rel="prefetch" href="/assets/js/12.571448aa.js"><link rel="prefetch" href="/assets/js/13.e5a600e9.js"><link rel="prefetch" href="/assets/js/14.4ed01dd2.js"><link rel="prefetch" href="/assets/js/15.d0a813d8.js"><link rel="prefetch" href="/assets/js/16.3d701298.js"><link rel="prefetch" href="/assets/js/17.dd96adea.js"><link rel="prefetch" href="/assets/js/18.f6955aa8.js"><link rel="prefetch" href="/assets/js/19.bb1f166c.js"><link rel="prefetch" href="/assets/js/20.440b537e.js"><link rel="prefetch" href="/assets/js/21.1e192f13.js"><link rel="prefetch" href="/assets/js/22.0f3db856.js"><link rel="prefetch" href="/assets/js/23.9a2edb75.js"><link rel="prefetch" href="/assets/js/24.3d8317a7.js"><link rel="prefetch" href="/assets/js/25.e6e973f9.js"><link rel="prefetch" href="/assets/js/26.2f4dce51.js"><link rel="prefetch" href="/assets/js/27.eddfbfe3.js"><link rel="prefetch" href="/assets/js/28.1a753628.js"><link rel="prefetch" href="/assets/js/29.dd0c2751.js"><link rel="prefetch" href="/assets/js/30.049ba17e.js"><link rel="prefetch" href="/assets/js/31.ec7a699c.js"><link rel="prefetch" href="/assets/js/32.128041a3.js"><link rel="prefetch" href="/assets/js/33.90a80a82.js"><link rel="prefetch" href="/assets/js/34.640d5210.js"><link rel="prefetch" href="/assets/js/36.af0fb7fb.js"><link rel="prefetch" href="/assets/js/37.6282d3d3.js"><link rel="prefetch" href="/assets/js/38.09c22a9c.js"><link rel="prefetch" href="/assets/js/39.34118569.js"><link rel="prefetch" href="/assets/js/4.004aaf89.js"><link rel="prefetch" href="/assets/js/40.42fb5da5.js"><link rel="prefetch" href="/assets/js/41.d1ac92f4.js"><link rel="prefetch" href="/assets/js/42.046bbbbf.js"><link rel="prefetch" href="/assets/js/43.86ac5d2f.js"><link rel="prefetch" href="/assets/js/44.1393eed1.js"><link rel="prefetch" href="/assets/js/45.a4121f00.js"><link rel="prefetch" href="/assets/js/46.f78d075f.js"><link rel="prefetch" href="/assets/js/47.02e428da.js"><link rel="prefetch" href="/assets/js/48.3f9d12a6.js"><link rel="prefetch" href="/assets/js/49.bb9c3fab.js"><link rel="prefetch" href="/assets/js/5.8a61fa12.js"><link rel="prefetch" href="/assets/js/50.ebb028fd.js"><link rel="prefetch" href="/assets/js/51.a2b343de.js"><link rel="prefetch" href="/assets/js/52.2a464137.js"><link rel="prefetch" href="/assets/js/53.54a07d54.js"><link rel="prefetch" href="/assets/js/54.72acf66d.js"><link rel="prefetch" href="/assets/js/55.6168cc1a.js"><link rel="prefetch" href="/assets/js/56.0653a59a.js"><link rel="prefetch" href="/assets/js/57.df56ec02.js"><link rel="prefetch" href="/assets/js/58.fc8f11bc.js"><link rel="prefetch" href="/assets/js/59.158abf7b.js"><link rel="prefetch" href="/assets/js/6.1fda51af.js"><link rel="prefetch" href="/assets/js/60.10f7e3a6.js"><link rel="prefetch" href="/assets/js/61.844ecd3b.js"><link rel="prefetch" href="/assets/js/62.da039f8c.js"><link rel="prefetch" href="/assets/js/63.f2fe69a7.js"><link rel="prefetch" href="/assets/js/64.b9085bd9.js"><link rel="prefetch" href="/assets/js/65.6c182c91.js"><link rel="prefetch" href="/assets/js/66.e0d48b84.js"><link rel="prefetch" href="/assets/js/7.eca4725c.js"><link rel="prefetch" href="/assets/js/8.2504867c.js"><link rel="prefetch" href="/assets/js/9.64046c51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.757cca11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cold Elm Coders</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Archived Articles</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/archivedarticles/" aria-current="page" class="sidebar-link">Articles</a></li><li><a href="/archivedarticles/All-In-One-World-Blazor.html" class="sidebar-link">Building a Site that Delivers Blazor Server and WASM</a></li><li><a href="/archivedarticles/AsyncProgramming.html" class="sidebar-link">Async Programming in Blazor</a></li><li><a href="/archivedarticles/Editor-Framework.html" aria-current="page" class="active sidebar-link">Building an Editor Framework</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#sample-code" class="sidebar-link">Sample Code</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#infrastructure-classes" class="sidebar-link">Infrastructure Classes</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#recordeditcontext" class="sidebar-link">RecordEditContext</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#dbweatherforecast" class="sidebar-link">DbWeatherForecast</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#data-services" class="sidebar-link">Data Services</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#weatherforecastdataservice" class="sidebar-link">WeatherForecastDataService</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#building-the-ui" class="sidebar-link">Building the UI</a></li><li class="sidebar-sub-header"><a href="/archivedarticles/Editor-Framework.html#wrap-up" class="sidebar-link">Wrap Up</a></li></ul></li><li><a href="/archivedarticles/Exploring Blazor Component Rendering.html" class="sidebar-link">Exploring Blazor Component Rendering</a></li><li><a href="/archivedarticles/Modal-Editor.html" class="sidebar-link">The Modal Editor</a></li><li><a href="/archivedarticles/Rebuilding the Blazor Component.html" class="sidebar-link">Building a new Blazor Base Component</a></li><li><a href="/archivedarticles/Replacing Blazor Routing with ViewManager.html" class="sidebar-link">An Alternative to Routing in Blazor</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="building-an-editor-framework"><a href="#building-an-editor-framework" class="header-anchor">#</a> Building an Editor Framework</h1> <p>This is the second of two articles looking at how to implement edit form controls in Blazor.</p> <p>The first article explored how to control what the user could do once a form was dirty; in essence how to stop a user unintentionally exiting.  This article describes how to build a framework that detects when the dataset is dirty and/or invalid and &quot;locks&quot; the application.</p> <p>Many probably consider that Blazor already has enough functionality for edit data.  Why do you need to re-invent the wheel is a valid question?  If you fervently believe this is true, read no further: this article isn't for you.  If not then read on and manke your own decision.</p> <p>A little recent background. C# 9 introduced the <code>Record</code> type, creating an immutable reference type.  The property <code>{get; init;}</code> lets us create an immutable property.  These are recent language changes: Microsoft seems to have done a little rethinking!</p> <p>I'm a firm believer in maintaining the integrity of records and recordsets read from databases.  What you see in your reference record or recordset is what is in the database.  If you want to edit something, there's a process, not just change the original.  Make a copy, change the copy, submit the copy to the database and then refresh your reference data from the database.</p> <p>The editing framework I use, described in this article, implements those principles.</p> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>This short discussion and the project uses the out-of-the-box Blazor WeatherForecast record as our example.</p> <p><code>DbWeatherForecast</code> represents the record read from the database.  It's declared as a <code>class</code>, not a <code>record</code>: only the properties that represent database fields are immutable. The editable version of   <code>DbWeatherForecast</code> is held in a <code>RecordCollection</code>.  <code>DbWeatherForecast</code> has methods to build and read data from a <code>RecordCollection</code>.  A <code>RecordCollection</code> is an <code>IEnumerable</code> object containing a list of <code>RecordFieldValue</code> objects.  Each represents a field/property in <code>DbWeatherForecast</code>.  A <code>RecordFieldValue</code> has a set of immutable fields itself, <code>Value</code> and <code>FieldName</code>, and an <code>EditedValue</code> field which can be set.  <code>IsDirty</code> is a boolean property that represents the edit state of <code>RecordFieldValue</code>. The <code>RecordCollection</code> and <code>RecordFieldValue</code> classes provide controlled access to the underlying data values.</p> <p><code>WeatherForecastEditContext</code> is the UI editor object for <code>DbWeatherForecast</code>, exposing the editable properties of the <code>RecordCollection</code> for <code>DbWeatherForecast</code>.  It has a symbiotic relationship with the <code>EditContext</code>, tracking the edit state of the <code>RecordCollection</code> and providing validation of any properties that require data validation.</p> <p>In the project <code>WeatherForecastControllerService</code> is the business object that provides access to the WeatherForecast data.  The editor and viewer call <code>GetForecastAsync(id)</code> to load the current <code>DbWeatherForecast</code> record in <code>WeatherForecastControllerService</code>. <code>RecordData</code> the <code>RecordCollection</code> for the <code>DbWeatherForecast</code> record is populated by <code>GetForecastAsync(id)</code>.  When the UI initilaizes an instance of <code>WeatherForecastEditContext</code> it passes it the <code>WeatherForecastControllerService</code> <code>RecordData</code> <code>RecordCollection</code>.  It's important to note at this point that <code>RecordData</code> isn't replaced when a new <code>DbWeatherForecast</code> is loaded, it's cleared and then re-populated: the reference passed to <code>WeatherForecastEditContext</code> is always valid.</p> <h2 id="sample-code"><a href="#sample-code" class="header-anchor">#</a> Sample Code</h2> <p>As always there's a GitHub Repo <a href="https://github.com/ShaunCurtis/CEC.Blazor.Editor" target="_blank" rel="noopener noreferrer">CEC.Blazor.Editor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  CEC.Blazor.ModalEditor is the project for this article.</p> <h2 id="infrastructure-classes"><a href="#infrastructure-classes" class="header-anchor">#</a> Infrastructure Classes</h2> <p>As always we need some supporting classes for the main show.</p> <h4 id="recordfieldvalue"><a href="#recordfieldvalue" class="header-anchor">#</a> RecordFieldValue</h4> <p>As already discussed, <code>RecordFieldValue</code> holds information about a field in a Record set.  Note:</p> <ol><li>The properties derived from the actual record are <code>{get; init;}</code>.  They can only be set when an instance of <code>RecordFieldValue</code> is created.</li> <li><code>FieldName</code> is property name for the field.  We define it to ensure we use the same string value throughout the application.</li> <li><code>Value</code> is the database value of the field.</li> <li><code>ReadOnly</code> is self-evident. It's for labelling derived/calculated fields.</li> <li><code>DisplayName</code> is the string to use when displaying the name of the field.</li> <li><code>EditedValue</code> is the current value of the field in our edit context.  The getter ensures that on first get, if it hasn't already been set, it's set to <code>Value</code>.</li> <li><code>IsDirty</code> does the default equality check for the object type on <code>Value</code> against <code>EditedValue</code> to determine if the Field is dirty.</li> <li><code>Reset</code> sets <code>EditedValue</code> back to <code>Value</code>.</li> <li>The two <code>Clone</code> methods create new copies of <code>RecordEditValue</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecordFieldValue</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FieldName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> ReadOnly <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DisplayName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> EditedValue
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_EditedValue <span class="token keyword">is</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_EditedValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_EditedValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">set</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_EditedValue <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> _EditedValue <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>Value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> EditedValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">!</span>Value<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>EditedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>Value <span class="token keyword">is</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> EditedValue <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token function">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token function">RecordFieldValue</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> field<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName <span class="token operator">=</span> field<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>EditedValue <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>GUID <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditedValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">RecordFieldValue</span> <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                DisplayName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DisplayName<span class="token punctuation">,</span>
                FieldName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span>
                Value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">,</span>
                ReadOnly <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ReadOnly
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">RecordFieldValue</span> <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                DisplayName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DisplayName<span class="token punctuation">,</span>
                FieldName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span>
                Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">,</span>
                ReadOnly <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ReadOnly
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="recordcollection"><a href="#recordcollection" class="header-anchor">#</a> RecordCollection</h3> <p><code>RecordCollection</code> is a managed <code>IEnumerable</code> collection of <code>RecordFieldValue</code> objects.  Note:</p> <ol><li>There are lots of getters, setters, etc for accessing and updating the individual <code>RecordFieldValue</code> objects.</li> <li><code>IsDirty</code> checks for any dirty items in the collection.</li> <li><code>FieldValueChanged</code> is an event triggered whenever an individual <code>RecordFieldValue</code> is set.  You can see it being invoked when <code>SetField</code> is called.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecordCollection</span> <span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>RecordFieldValue<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>RecordFieldValue<span class="token punctuation">&gt;</span></span> _items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>RecordFieldValue<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Count <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> FieldValueChanged<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&lt;</span>RecordFieldValue<span class="token punctuation">&gt;</span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> _items<span class="token punctuation">)</span>
                <span class="token keyword">yield</span> <span class="token keyword">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token return-type class-name">IEnumerator</span> IEnumerable<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ResetValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// .......  lots of getters, setters, deleters, adders.  A few examples show.</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> FieldName<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> _items<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>FieldName<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>CurrentCultureIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> FieldName<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> _items<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>FieldName<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>CurrentCultureIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">.</span>EditedValue <span class="token keyword">is</span> <span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SetField</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> FieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> _items<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>FieldName<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>CurrentCultureIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                x<span class="token punctuation">.</span>EditedValue <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>FieldValueChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> _items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="recordeditcontext"><a href="#recordeditcontext" class="header-anchor">#</a> RecordEditContext</h2> <p><code>RecordEditContext</code> is the base class for the record edit context.  It contains the boilerplate code.  We'll look at it in more detail in <code>WeatherForecastEditContext</code>.  Key points to note:</p> <ol><li>It's initiliaiser requires a <code>RecordCollection</code> object.  In the application this is the ControllerService <code>RecordCollection</code> called <code>RecordData</code> associated with the current record.  It gets loaded whenever the record cahnges.</li> <li>It holds a reference to the valid <code>EditContext</code> and expects to be notified of changes.</li> <li>It handles Validation for the <code>EditContext</code> and is wired into <code>EditContext.OnValidationRequested</code>.</li> <li>It holds a List of <code>ValidationActions</code> which get run whenever validation is triggered.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RecordEditContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRecordEditContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValid <span class="token operator">=&gt;</span> <span class="token operator">!</span>Trip<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">?.</span>IsDirty <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsClean <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsDirty<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLoaded <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name">RecordCollection</span> RecordValues <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> Trip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> ValidationActions <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadValidationActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token class-name">ValidationMessageStore</span> ValidationMessageStore<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> Validating<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">RecordEditContext</span><span class="token punctuation">(</span><span class="token class-name">RecordCollection</span> collection<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">Assert</span><span class="token punctuation">(</span>collection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>collection <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RecordEditContext<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> requires a valid </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RecordCollection<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> object&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues <span class="token operator">=</span> collection<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LoadValidationActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// using Validating to stop being called multiple times</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ValidationMessageStore <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>Validating<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Validating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token comment">// clear the message store and trip wire and check we have Validators to run</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Trip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> validator <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// invoke the action - defined as a func&lt;bool&gt; and trip if validation failed (false)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">NotifyValidationStateChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Validating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
           <span class="token keyword">return</span> IsValid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">NotifyEditContextChangedAsync</span><span class="token punctuation">(</span><span class="token class-name">EditContext</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> oldcontext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RecordEditContext<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> - NotifyEditContextChangedAsync requires a valid </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>EditContext<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> object&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// if we already have an edit context, we will have registered with OnValidationRequested, so we need to drop it before losing our reference to the editcontext object.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>EditContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                EditContext<span class="token punctuation">.</span>OnValidationRequested <span class="token operator">-=</span> ValidationRequested<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// assign the Edit Context internally</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsLoaded<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Get the Validation Message Store from the EditContext</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationMessageStore</span><span class="token punctuation">(</span>EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Wire up to the Editcontext to service Validation Requests</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span>OnValidationRequested <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationRequested<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Call a validation on the current data set</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ValidationRequested</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">ValidationRequestedEventArgs</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dbweatherforecast"><a href="#dbweatherforecast" class="header-anchor">#</a> DbWeatherForecast</h2> <p>The new Weather forecast record.  While we only create these records on the fly, a normal application would get them from a database.</p> <p>Note:</p> <ol><li>There's a static declared <code>RecordFieldValue</code> for each database property/field in the class.  In a larger application these should be declared in a central <code>DataDictionary</code>.</li> <li>The &quot;Database&quot; properties are all declared <code>{ get; init; }</code>: they're immutable.</li> <li><code>AsRecordCollection</code> builds a <code>RecordCollection</code> object from the record.</li> <li><code>FromRecordCollection</code> is static, it builds a new record from the supplied <code>RecordCollection</code> using the edited values.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DbWeatherForecast</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordFieldValue</span> __ID <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> FieldName <span class="token operator">=</span> <span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> <span class="token string">&quot;ID&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordFieldValue</span> __Date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> FieldName <span class="token operator">=</span> <span class="token string">&quot;Date&quot;</span><span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> <span class="token string">&quot;Forecast Date&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordFieldValue</span> __TemperatureC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> FieldName <span class="token operator">=</span> <span class="token string">&quot;TemperatureC&quot;</span><span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> <span class="token string">&quot;Temperature C&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordFieldValue</span> __TemperatureF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> FieldName <span class="token operator">=</span> <span class="token string">&quot;TemperatureF&quot;</span><span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> <span class="token string">&quot;Temperature F&quot;</span><span class="token punctuation">,</span> ReadOnly <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordFieldValue</span> __Summary <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> FieldName <span class="token operator">=</span> <span class="token string">&quot;Summary&quot;</span><span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> <span class="token string">&quot;Summary&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Date <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> TemperatureC <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> TemperatureF <span class="token operator">=&gt;</span> <span class="token number">32</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TemperatureC <span class="token operator">/</span> <span class="token number">0.5556</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Summary <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> init<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">RecordCollection</span> AsRecordCollection
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> coll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">{</span>
                    coll<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>__ID<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    coll<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>__Date<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    coll<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>__TemperatureC<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TemperatureC<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    coll<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>__TemperatureF<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TemperatureF<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    coll<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>__Summary<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Summary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> coll<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DbWeatherForecast</span> <span class="token function">FromRecordCollection</span><span class="token punctuation">(</span><span class="token class-name">RecordCollection</span> coll<span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DbWeatherForecast</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ID <span class="token operator">=</span> coll<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Guid<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>__ID<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                Date <span class="token operator">=</span> coll<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>__Date<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                TemperatureC <span class="token operator">=</span> coll<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>__TemperatureC<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                Summary <span class="token operator">=</span> coll<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>__Summary<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="data-services"><a href="#data-services" class="header-anchor">#</a> Data Services</h2> <p>I've split up the data access into a data and a controller service: makes it more realistic.  We may be creating a dummy data set, but I'm mimicing normal practice.  In a production system this would run on interfaces and boilerplated base code implementations.</p> <h2 id="weatherforecastdataservice"><a href="#weatherforecastdataservice" class="header-anchor">#</a> WeatherForecastDataService</h2> <p>The Data Service:</p> <ol><li>Builds the dummy data set on startup.</li> <li>Provides <em>CRUD</em> data operations on that dataset.</li> <li>We're using Guids for Ids.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastDataService</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Summaries <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;Freezing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bracing&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Chilly&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Cool&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mild&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Warm&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Balmy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hot&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sweltering&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Scorching&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">&gt;</span></span> Forecasts <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">WeatherForecastDataService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token function">PopulateForecasts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PopulateForecasts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> rng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Forecasts<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DbWeatherForecast</span>
                <span class="token punctuation">{</span>
                    ID <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    TemperatureC <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Summary <span class="token operator">=</span> Summaries<span class="token punctuation">[</span>rng<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>Summaries<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetForecastsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">&gt;</span></span> <span class="token function">GetForecastAsync</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> id<span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>ID<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Guid<span class="token punctuation">&gt;</span></span> <span class="token function">UpdateForecastAsync</span><span class="token punctuation">(</span><span class="token class-name">DbWeatherForecast</span> record<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> rec <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>ID<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rec <span class="token operator">!=</span> <span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>rec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Guid<span class="token punctuation">&gt;</span></span> <span class="token function">AddForecastAsync</span><span class="token punctuation">(</span><span class="token class-name">DbWeatherForecast</span> record<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">.</span>ID<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> recdata <span class="token operator">=</span> record<span class="token punctuation">.</span>AsRecordCollection<span class="token punctuation">;</span>
                recdata<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__ID<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                record <span class="token operator">=</span> DbWeatherForecast<span class="token punctuation">.</span><span class="token function">FromRecordCollection</span><span class="token punctuation">(</span>recdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> rec <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>ID<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>rec <span class="token operator">!=</span> <span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="controller-data"><a href="#controller-data" class="header-anchor">#</a> Controller Data</h4> <p>The controller service is the interface between the data and the UI, providing a high level business logic interface into the data.  Most of the Properties and Methods are self-evident.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastControllerService</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">WeatherForecastDataService</span> DataService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler</span> RecordChanged<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler</span> ListChanged<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">RecordCollection</span> RecordData <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">&gt;</span></span> Forecasts <span class="token punctuation">{</span> 
            <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _Forecasts<span class="token punctuation">;</span>
            <span class="token keyword">private</span> <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                _Forecasts <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                ListChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> EventArgs<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">&gt;</span></span> _Forecasts<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">DbWeatherForecast</span> Forecast
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _Forecast<span class="token punctuation">;</span>
            <span class="token keyword">private</span> <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                _Forecast <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                RecordData<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>_Forecast<span class="token punctuation">.</span>AsRecordCollection<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                RecordChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>_Forecast<span class="token punctuation">,</span> EventArgs<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token class-name">DbWeatherForecast</span> _Forecast<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">WeatherForecastControllerService</span><span class="token punctuation">(</span><span class="token class-name">WeatherForecastDataService</span> weatherForecastDataService <span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DataService <span class="token operator">=</span> weatherForecastDataService<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">GetForecastsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Forecasts <span class="token operator">=</span> <span class="token keyword">await</span> DataService<span class="token punctuation">.</span><span class="token function">GetForecastsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">GetForecastAsync</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Forecast <span class="token operator">=</span> <span class="token keyword">await</span> DataService<span class="token punctuation">.</span><span class="token function">GetForecastAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>RecordChanged<span class="token punctuation">,</span> EventArgs<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">SaveForecastAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Guid</span> id <span class="token operator">=</span> Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> record <span class="token operator">=</span> DbWeatherForecast<span class="token punctuation">.</span><span class="token function">FromRecordCollection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Forecast<span class="token punctuation">.</span>ID<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 id <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DataService<span class="token punctuation">.</span><span class="token function">AddForecastAsync</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
              id <span class="token operator">=</span>  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DataService<span class="token punctuation">.</span><span class="token function">UpdateForecastAsync</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">await</span> <span class="token function">GetForecastAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token operator">!</span>id<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="building-the-ui"><a href="#building-the-ui" class="header-anchor">#</a> Building the UI</h2> <p>Moving on to the UI and digressing a little.</p> <h3 id="ui-components"><a href="#ui-components" class="header-anchor">#</a> UI Components</h3> <p>A gripe I have with much of the UI code I see is HTML repetition.  What coders do in Razor Markup they would never dream of doing in C# code.  Editor/Display/List forms are good examples.  I've moved most of the repetitive HTML markup into <em>UI Components</em>: in my applications HTML markup doesn't belong in high level components.  A formatting issue such as not enough spacing. Fix it in one place and it's fixed everywhere!</p> <p>Let's take a look at a couple of examples. All the UI components are in the <em>UIComponents</em> directory.</p> <h4 id="uiformrow"><a href="#uiformrow" class="header-anchor">#</a> UIFormRow</h4> <p>Not rocket science.  <code>ChildContent</code> is the default definition of what gets entered between the opening and closing statements.</p> <div class="language-html extra-class"><pre class="language-html"><code>@namespace CEC.Blazor.Editor

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    @this.ChildContent
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code>@code <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> ChildContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With this you can now declare each row as:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
    ....(ChildContent)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="uibutton"><a href="#uibutton" class="header-anchor">#</a> UIButton</h4> <p>Again simple, but it keeps the high level declaration minimal.</p> <div class="language-html extra-class"><pre class="language-html"><code>@if (this.Show)
{
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn mr-1 @this.CssColor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ButtonClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        @this.ChildContent
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
}
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code>@code <span class="token punctuation">{</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Show <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">EventCallback<span class="token punctuation">&lt;</span>MouseEventArgs<span class="token punctuation">&gt;</span></span> ClickEvent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CssColor <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">&quot;btn-primary&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> ChildContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ButtonClick</span><span class="token punctuation">(</span><span class="token class-name">MouseEventArgs</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ClickEvent<span class="token punctuation">.</span><span class="token function">InvokeAsync</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIButton</span> <span class="token attr-name">CssColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-success<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.CanSave<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ClickEvent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.Save<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@this.SaveButtonText<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIButton</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="modaleditform"><a href="#modaleditform" class="header-anchor">#</a> ModalEditForm</h4> <p><code>ModalEditForm</code> replaces <code>EditForm</code>.  It:</p> <ol><li>Has three RenderFragments.</li> <li><code>LoadingContent</code> is only shown whilst the form is loading.</li> <li><code>EditorContent</code> is shown once loading is complete.  It cascades <code>EditContext</code>.</li> <li><code>ButtonContent</code> is always shown at the bottom of the control.</li> <li><code>Loaded</code> controls what gets rendered.</li> <li>We build the control with <code>BuildRenderTree</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Rendering</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>ModalEditor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModalEditForm</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ComponentBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> EditorContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> ButtonContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> LoadingContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Loaded <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext <span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BuildRenderTree</span><span class="token punctuation">(</span><span class="token class-name">RenderTreeBuilder</span> builder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Loaded<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                builder<span class="token punctuation">.</span><span class="token function">OpenRegion</span><span class="token punctuation">(</span>EditContext<span class="token punctuation">.</span><span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CascadingValue<span class="token punctuation">&lt;</span>EditContext<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;IsFixed&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;ChildContent&quot;</span><span class="token punctuation">,</span> EditorContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                builder<span class="token punctuation">.</span><span class="token function">CloseRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
                builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> LoadingContent <span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> ButtonContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="weatherdatamodal"><a href="#weatherdatamodal" class="header-anchor">#</a> WeatherDataModal</h3> <p>Moving on to the real UI stuff.</p> <p>This replaces <code>FetchData</code>.  It's similar.  The <code>Edit</code> and <code>View</code> buttons now pass the <code>ID</code> of the record.  I haven't replaced the HTML with UI controls, so you can see how little has changed.</p> <div class="language-html extra-class"><pre class="language-html"><code>@page &quot;/weatherdatamodal&quot;
@using CEC.Blazor.Editor.Data
@namespace CEC.Blazor.Editor.Pages

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ModalDialog</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.Modal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ModalDialog</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Weather forecast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This component demonstrates fetching data from a service.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

@if (this.ForecastService.Forecasts == null)
{
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
}
else
{
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Date<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Temp. (C)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Temp. (F)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Summary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
            @foreach (var forecast in this.ForecastService.Forecasts)
            {
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@forecast.Date.ToShortDateString()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@forecast.TemperatureC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@forecast.TemperatureF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@forecast.Summary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm btn-secondary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; ShowViewDialog(forecast.ID)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm btn-primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; ShowEditDialog(forecast.ID)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            }
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
}
</code></pre></div><p>In code:</p> <ol><li>We now use the new <code>WeatherForecastControllerService</code>, and the Razor markup uses the service <code>Forecasts</code> list.</li> <li>We load the <code>Forecasts</code> list in <code>WeatherForecastControllerService</code> as part of the form <code>OnInitializedAsync()</code>.</li> <li>The two button handlers create a <code>ModalOptions</code> object and add the <code>ID</code> to pass into the editor and viewer forms.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor<span class="token punctuation">.</span>Pages</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">WeatherDataModal</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ComponentBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Inject</span></span><span class="token punctuation">]</span> <span class="token return-type class-name">WeatherForecastControllerService</span> ForecastService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name">ModalDialog</span> Modal <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnInitializedAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> ForecastService<span class="token punctuation">.</span><span class="token function">GetForecastsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowViewDialog</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ModalOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>ModalOptions<span class="token punctuation">.</span>__Width<span class="token punctuation">,</span> <span class="token string">&quot;80%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                options<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>ModalOptions<span class="token punctuation">.</span>__ID<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShowAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherViewer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowEditDialog</span><span class="token punctuation">(</span><span class="token class-name">Guid</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ModalOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>ModalOptions<span class="token punctuation">.</span>__Width<span class="token punctuation">,</span> <span class="token string">&quot;80%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                options<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>ModalOptions<span class="token punctuation">.</span>__ID<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShowAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecastEditor<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="weatherforecasteditor"><a href="#weatherforecasteditor" class="header-anchor">#</a> WeatherForecastEditor</h3> <p>The Editor is the container that sets up all the edit components and then updates the buttons in the UI as things change in the underlying EditContext and RecordEditorContext.  A set of Boolean Properties control the UI and button state.</p> <p>On Initialization it:</p> <ol><li>Gets the record ID from <code>ModalOptions</code>.</li> <li>Loads the controller <code>DbWeatherForecast</code> - which loads <code>RecordData</code>, the <code>RecordCollection</code> object in the service.</li> <li>Creates a new <code>RecordEditorContext</code>, passing in the <code>RecordCollection</code>.</li> <li>Creates a <code>EditContext</code> with <code>RecordEditorContext</code> as the modal.</li> <li>Notifies <code>RecordEditorContext</code> that the <code>EditContext</code> has changed.</li> <li>Wires up the <code>EditContext.OnFieldChanged</code> event to a local <code>OnFieldChanged</code> event handler.</li></ol> <p>Key points to note:</p> <ol><li>The editor wires up a local property to the cascaded ModalDialog so it can lock and unlock the form and exit.</li> <li>Contains the save and various exit methods.</li> <li><code>OnFieldChanged</code> sorts out the UI buttons, form locking and rendering.  It doesn't interact with the data - that's all done by the <code>RecordEditorContext</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastEditor</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ComponentBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext <span class="token operator">=&gt;</span> _EditContext<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">EditContext</span> _EditContext <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name">WeatherForecastEditContext</span> RecordEditorContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Inject</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token return-type class-name">WeatherForecastControllerService</span> ControllerService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CascadingParameter</span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token return-type class-name">IModalDialog</span> Modal <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsModal <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Modal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> HasServices <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsModal <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> IsDirtyExit<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token operator">=&gt;</span> RecordEditorContext<span class="token punctuation">.</span>IsDirty<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValid <span class="token operator">=&gt;</span> RecordEditorContext<span class="token punctuation">.</span>IsValid<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLoaded <span class="token operator">=&gt;</span> RecordEditorContext<span class="token punctuation">?.</span>IsLoaded <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> CanSave <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsDirty <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsValid<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> CanExit <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsDirtyExit<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SaveButtonText <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">.</span>Forecast<span class="token punctuation">.</span>ID<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token string">&quot;Save&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Update&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnInitializedAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//await Task.Yield();</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>HasServices <span class="token operator">&amp;&amp;</span> Modal<span class="token punctuation">.</span>Options<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryGet</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Guid<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>ModalOptions<span class="token punctuation">.</span>__ID<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">Guid</span> modalid<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">.</span><span class="token function">GetForecastAsync</span><span class="token punctuation">(</span>modalid<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherForecastEditContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">.</span>RecordData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>_EditContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EditContext</span><span class="token punctuation">(</span>RecordEditorContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span><span class="token function">NotifyEditContextChangedAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span>OnFieldChanged <span class="token operator">+=</span> OnFieldChanged<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnInitializedAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnFieldChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>IsDirtyExit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">InvokeAsync</span><span class="token punctuation">(</span>StateHasChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> ok <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">// Validate the EditContext</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Save the Record</span>
                ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">.</span><span class="token function">SaveForecastAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// Set the EditContext State</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">MarkAsUnmodified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Set the View Lock i.e. unlock it</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> ok<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>RecordEditorContext<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>IsDirtyExit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">InvokeAsync</span><span class="token punctuation">(</span>StateHasChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
            <span class="token keyword">else</span> 
                <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>ModalResult<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DirtyExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>ModalResult<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CancelExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">=&gt;</span> <span class="token function">SetLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The markup code is fairly standard editor fare.</p> <ol><li>You can see the use of the UIComponents to standardize the HTML.</li> <li><code>EditForm</code> is replaced by <code>ModalEditForm</code>.  It ensures content isn't rendered until it's loaded and cascades the <code>EditContext</code>.</li> <li>The buttons use the various boolean properties to control their display state.</li></ol> <div class="language-html extra-class"><pre class="language-html"><code>@namespace CEC.Blazor.ModalEditor
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIContainer</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIColumn</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Weather Forecast Editor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIColumn</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIContainer</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ModalEditForm</span> <span class="token attr-name">EditContext</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.EditContext<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Loaded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.IsLoaded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LoadingContent</span><span class="token punctuation">&gt;</span></span>
            ... loading
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LoadingContent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditorContent</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIContainer</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UILabelColumn</span><span class="token punctuation">&gt;</span></span>
                        Date
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UILabelColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIInputColumn</span> <span class="token attr-name">Cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputDate</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@bind-Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.RecordEditorContext.Date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>InputDate</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIInputColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIColumn</span> <span class="token attr-name">Cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIValidationColumn</span><span class="token punctuation">&gt;</span></span>
                        &lt;ValidationMessage For=@(() =&gt; this.RecordEditorContext.Date) /&gt;
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIValidationColumn</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UILabelColumn</span><span class="token punctuation">&gt;</span></span>
                        Temperature <span class="token entity named-entity" title="&amp;deg;">&amp;deg;</span>C
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UILabelColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIInputColumn</span> <span class="token attr-name">Cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputNumber</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@bind-Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.RecordEditorContext.TemperatureC<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>InputNumber</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIInputColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIColumn</span> <span class="token attr-name">Cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIValidationColumn</span><span class="token punctuation">&gt;</span></span>
                        &lt;ValidationMessage For=@(() =&gt; this.RecordEditorContext.TemperatureC) /&gt;
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIValidationColumn</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UILabelColumn</span><span class="token punctuation">&gt;</span></span>
                        Summary
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UILabelColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIInputColumn</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputText</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@bind-Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.RecordEditorContext.Summary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>InputText</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIInputColumn</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIValidationColumn</span><span class="token punctuation">&gt;</span></span>
                        &lt;ValidationMessage For=@(() =&gt; this.RecordEditorContext.Summary) /&gt;
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIValidationColumn</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIContainer</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EditorContent</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ButtonContent</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIContainer</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIButtonColumn</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIButton</span> <span class="token attr-name">CssColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-success<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.CanSave<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ClickEvent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.Save<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@this.SaveButtonText<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIButton</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIButton</span> <span class="token attr-name">CssColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.IsDirtyExit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ClickEvent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.DirtyExit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Exit Without Saving<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIButton</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIButton</span> <span class="token attr-name">CssColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-warning<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.IsDirtyExit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ClickEvent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.CancelExit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Cancel Exit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIButton</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UIButton</span> <span class="token attr-name">CssColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-secondary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.CanExit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ClickEvent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>this.Exit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Exit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIButton</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIButtonColumn</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIFormRow</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UIContainer</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ButtonContent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ModalEditForm</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="weatherforecasteditorcontext"><a href="#weatherforecasteditorcontext" class="header-anchor">#</a> WeatherForecastEditorContext</h3> <p>Note:</p> <ol><li>The Properties exposing the underlying fields in <code>RecordValues</code>, referenced all the way back to the <code>RecordCollection</code> object in the ControllerService.</li> <li>The Property setters set the <code>EditedValue</code> on the <code>RecordFieldValue</code>.</li> <li>The Property setters calling <code>Validate</code> and precipitating the validation process throughout the edit components in the form - turning any control red and displaying any validation messages.</li> <li><code>Validators</code> defined for properties requiring validation.</li> <li>The validators loaded through <code>LoadValidationActions</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastEditContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RecordEditContext</span><span class="token punctuation">,</span> <span class="token class-name">IRecordEditContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Date
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__Date<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__Date<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Summary
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__Summary<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__Summary<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> TemperatureC
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__TemperatureC<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">set</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__TemperatureC<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> WeatherForecastID
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Guid<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__ID<span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">WeatherForecastEditContext</span><span class="token punctuation">(</span><span class="token class-name">RecordCollection</span> collection<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadValidationActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidateSummary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidateTemperatureC<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidateDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidateSummary</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Summary<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__Summary<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ValidationMessageStore<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">LongerThan</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Your description needs to be a little longer! 3 letters minimum&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidateDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__Date<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ValidationMessageStore<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">NotDefault</span><span class="token punctuation">(</span><span class="token string">&quot;You must select a date&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddMonths</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;Date can only be up to 1 month ahead&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidateTemperatureC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>TemperatureC<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span>DbWeatherForecast<span class="token punctuation">.</span>__TemperatureC<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ValidationMessageStore<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token string">&quot;The temperature must be less than 70C&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token string">&quot;The temperature must be greater than -60C&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="validators"><a href="#validators" class="header-anchor">#</a> Validators</h3> <p><code>WeatherForecastEditorContext</code> uses a custom validation process.  It's not rocket science and once you understand the principles it very flexible.</p> <p>Skip down to the next section to see an implementation first before coming back to the the abstract <code>Validator</code> class.  It will make more sense.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Validator<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValid <span class="token operator">=&gt;</span> <span class="token operator">!</span>Trip<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> Trip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Messages <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FieldName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name">T</span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DefaultMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">&quot;The value failed validation&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name">ValidationMessageStore</span> ValidationMessageStore <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Model <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token function">Validator</span><span class="token punctuation">(</span><span class="token class-name">T</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> model<span class="token punctuation">,</span> <span class="token class-name">ValidationMessageStore</span> validationMessageStore<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName <span class="token operator">=</span> fieldName<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Model <span class="token operator">=</span> model<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore <span class="token operator">=</span> validationMessageStore<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>DefaultMessage <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DefaultMessage <span class="token punctuation">:</span> message<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                message <span class="token operator">??=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DefaultMessage<span class="token punctuation">;</span>
                <span class="token comment">// Check if we've logged specific messages.  If not add the default message</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Messages<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//set up a FieldIdentifier and add the message to the Edit Context ValidationMessageStore</span>
                <span class="token class-name"><span class="token keyword">var</span></span> fi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FieldIdentifier</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Model<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>fi<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsValid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LogMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="stringvalidator"><a href="#stringvalidator" class="header-anchor">#</a> StringValidator</h4> <p>This is a <code>Validator</code> for strings.</p> <p>The key to validators work is the static class.  <code>Validation</code> is an extension method for <code>string</code>.  When you call <code>Validation</code> on a string it creates a <code>StringValidator</code> object and returns it.  You now have a <code>StringValidator</code> that you can call a validation method on.  Each validation method returns a reference to the validation object.  You can chain as many as you like together with their specific messages.  You call the base <code>Validate</code> method to complete the process.  It logs any validation messages into the <code>ValidationMessageStore</code>, and returns true or false.  The <code>ValidationMessageStore</code> is linked back to the <code>EditContext</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>RegularExpressions</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Editor</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StringValidatorExtensions</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">StringValidator</span> <span class="token function">Validation</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> model<span class="token punctuation">,</span> <span class="token class-name">ValidationMessageStore</span> validationMessageStore<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> validation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringValidator</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> fieldName<span class="token punctuation">,</span> model<span class="token punctuation">,</span> validationMessageStore<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> validation<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Validator<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">StringValidator</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> model<span class="token punctuation">,</span> <span class="token class-name">ValidationMessageStore</span> validationMessageStore<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> fieldName<span class="token punctuation">,</span> model<span class="token punctuation">,</span> validationMessageStore<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">StringValidator</span> <span class="token function">LongerThan</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> test<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">StringValidator</span> <span class="token function">ShorterThan</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> test<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Length <span class="token operator">&lt;</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">StringValidator</span> <span class="token function">Matches</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> pattern<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> match <span class="token operator">=</span> Regex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">.</span>Success <span class="token operator">&amp;&amp;</span> match<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="what-makes-all-this-work"><a href="#what-makes-all-this-work" class="header-anchor">#</a> What Makes all this Work?</h3> <p>If you haven't dug through Microsoft's AspNetCore code on Github investigating how all the edit stuff hangs together, it can be a little baffling.</p> <p>There's an intrincate set of relationships and links within the edit form components that make all this work.  The net result is a lot of co-ordinated re-rendering of components to display validation problems, and the right buttons displayed at the right time.</p> <p>We've covered the intial load process for the form.  <code>&lt;UILoader Loaded=&quot;this.IsLoaded&quot;&gt;</code> controls when the form gets rendered. Once we have a live <code>EditContext</code> and interlinked <code>RecordEditorContext</code> <code>IsLoaded</code> is true.  All the Input controls get rendered and linked into the cascaded <code>EditContext</code>.  The first call to <code>NotifyEditContextChangedAsync</code> on <code>RecordEditorContext</code> runs a validation, so the form will display initial validation messages.</p> <p>Lets suppose we change the Summary.  Here's the important code snippet from <code>InputBase</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Code snippet from InputBase.cs</span>
<span class="token keyword">protected</span> <span class="token return-type class-name">TValue<span class="token punctuation">?</span></span> CurrentValue
<span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token operator">=&gt;</span> Value<span class="token punctuation">;</span>
    <span class="token keyword">set</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> hasChanged <span class="token operator">=</span> <span class="token operator">!</span>EqualityComparer<span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span><span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasChanged<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            _ <span class="token operator">=</span> ValueChanged<span class="token punctuation">.</span><span class="token function">InvokeAsync</span><span class="token punctuation">(</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            EditContext<span class="token punctuation">.</span><span class="token function">NotifyFieldChanged</span><span class="token punctuation">(</span>FieldIdentifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>On exiting the Summary edit control, the <code>InputText</code> control sets <code>Value = value</code> (<code>Value</code> is the property value in <code>RecordEditorContext</code>), invokes it's own <code>ValueChanged</code> event, followed by calling <code>NotifyFieldChanged</code> on <code>EditContext</code>.  This precipitates two processes.</p> <h4 id="recordeditorcontext-property-set"><a href="#recordeditorcontext-property-set" class="header-anchor">#</a> RecordEditorContext Property Set</h4> <p>The property set in <code>RecordEditorContext</code> sets the <code>EditedValue</code> of the <code>RecordFieldValue</code> to the new value and then kicks off <code>Validate</code> which performs a validation.  Set, <code>Validate</code> and subsiquent validations are all synchronous operations.  They complete before <code>NotifyFieldChanged</code> is called on <code>EditContext</code>.  This is important: the validation process is complete before <code>EditContext</code> runs code or kicks off any events.  The last action of <code>Validate</code> is to notify the <code>EditContext</code> that the Validation State has changed - <code>this.EditContext.NotifyValidationStateChanged()</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Code snippet from EditContext.cs</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NotifyValidationStateChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    OnValidationStateChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ValidationStateChangedEventArgs<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>EditContext</code> kicks off it's own <code>OnValidationStateChanged</code> event.  All the Input controls and <code>ValidationMessage</code> instances wire into this event as shown below.  The input controls check for a validation message relevant to them and change color and render if there is one.  <code>ValidationMessage</code> instances look up their relevant message and display it if they find one.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">SetParametersAsync</span><span class="token punctuation">(</span><span class="token class-name">ParameterView</span> parameters<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token range operator">..</span>
    EditContext<span class="token punctuation">.</span>OnValidationStateChanged <span class="token operator">+=</span> _validationStateChangedHandler<span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>All the affected fields get notifications of changes and can individually update and re-render themselves.</p> <h4 id="editcontext-fieldchanged"><a href="#editcontext-fieldchanged" class="header-anchor">#</a> EditContext.FieldChanged</h4> <p>The Input control passes <code>NotifyFieldChanged</code> a <code>FieldIdentifier</code> object - the property name it's linked to and the <code>Model</code> object - in our case <code>RecordEditorContext</code>.  <code>EditContext</code> updates it's internal FieldStates collection, logging the <code>FieldIdentifier</code> as <code>IsModified</code> in the <code>FieldState</code> object associated with the <code>FieldIdentifier</code>.  Finally it triggers the <code>OnFieldChanged</code> event.  The code snippet below shows <code>NotifyFieldChanged</code> in <code>EditContext</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Code snippet from EditContext.cs</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NotifyFieldChanged</span><span class="token punctuation">(</span><span class="token keyword">in</span> <span class="token class-name">FieldIdentifier</span> fieldIdentifier<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">GetOrAddFieldState</span><span class="token punctuation">(</span>fieldIdentifier<span class="token punctuation">)</span><span class="token punctuation">.</span>IsModified <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    OnFieldChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FieldChangedEventArgs</span><span class="token punctuation">(</span>fieldIdentifier<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The final bit of acrion takes place in the edit form.  The local method <code>OnFieldChanged</code> is wired to <code>EditContext.OnFieldChanged</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Code snippet from WeatherForecastEditor.razor.cs</span>
<span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnFieldChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>IsDirtyExit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Modal<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">InvokeAsync</span><span class="token punctuation">(</span>StateHasChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>SetLock</code> clears <code>IsDirtyExit</code> - set if our action was to try to exit a dirty form.  We then check if <code>RecordEditorContext</code> is dirty.  In our case it is so we lock the browser window.  We finally render the control which sorts out the buttons.  Note that if we had already edited the value once and then changed it back to the original, <code>RecordEditorContext</code> would be clean.  You could exit and the <em>Update</em> button would dissappear.</p> <h3 id="weatherforecast-viewer"><a href="#weatherforecast-viewer" class="header-anchor">#</a> WeatherForecast Viewer</h3> <p>I won't go into detail.  You can review the code in the Repo to see how it's put together.  It's a simple version of the editor, accessing the controller service record directly for it's data, and using a custom <code>InputReadOnlyText</code> component to display values.</p> <h2 id="wrap-up"><a href="#wrap-up" class="header-anchor">#</a> Wrap Up</h2> <p>Much of the infrastructure I've put together here is simplistic.  The services and data records should use interfaces and core abstract classes to provide abstraction and implement boilerplate code.  A set of articles - <a href="https://www.codeproject.com/Articles/5279560/Building-a-Database-Application-in-Blazor-Part-1-P" target="_blank" rel="noopener noreferrer">Building a Database Application<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>-  covers such a framework in more detail.  Note the current article set is based on my NetCore 3.1 four month old framework and will be revised very shortly.</p> <p>What I've covered here is a methodology for editing records.  It's not for everybody.  It depends on your mindset on data, and the environment you have to work in.  If nothing more, I hope it provokes you to think about how you view and deal with data.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/archivedarticles/AsyncProgramming.html" class="prev">
        Async Programming in Blazor
      </a></span> <span class="next"><a href="/archivedarticles/Exploring Blazor Component Rendering.html">
        Exploring Blazor Component Rendering
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e7504274.js" defer></script><script src="/assets/js/3.f3d70fce.js" defer></script><script src="/assets/js/35.dd6a5277.js" defer></script>
  </body>
</html>
