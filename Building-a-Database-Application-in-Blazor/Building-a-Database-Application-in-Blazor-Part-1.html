<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Part 1 - A Blazor Database Template - Project Structure and Framework | Cold Elm Coders</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.757cca11.css" as="style"><link rel="preload" href="/assets/js/app.e7504274.js" as="script"><link rel="preload" href="/assets/js/3.f3d70fce.js" as="script"><link rel="preload" href="/assets/js/23.9a2edb75.js" as="script"><link rel="prefetch" href="/assets/js/1.dd2e798d.js"><link rel="prefetch" href="/assets/js/10.62cd9054.js"><link rel="prefetch" href="/assets/js/11.7ef2f0cc.js"><link rel="prefetch" href="/assets/js/12.571448aa.js"><link rel="prefetch" href="/assets/js/13.e5a600e9.js"><link rel="prefetch" href="/assets/js/14.4ed01dd2.js"><link rel="prefetch" href="/assets/js/15.d0a813d8.js"><link rel="prefetch" href="/assets/js/16.3d701298.js"><link rel="prefetch" href="/assets/js/17.dd96adea.js"><link rel="prefetch" href="/assets/js/18.f6955aa8.js"><link rel="prefetch" href="/assets/js/19.bb1f166c.js"><link rel="prefetch" href="/assets/js/20.440b537e.js"><link rel="prefetch" href="/assets/js/21.1e192f13.js"><link rel="prefetch" href="/assets/js/22.0f3db856.js"><link rel="prefetch" href="/assets/js/24.3d8317a7.js"><link rel="prefetch" href="/assets/js/25.e6e973f9.js"><link rel="prefetch" href="/assets/js/26.2f4dce51.js"><link rel="prefetch" href="/assets/js/27.eddfbfe3.js"><link rel="prefetch" href="/assets/js/28.1a753628.js"><link rel="prefetch" href="/assets/js/29.dd0c2751.js"><link rel="prefetch" href="/assets/js/30.049ba17e.js"><link rel="prefetch" href="/assets/js/31.ec7a699c.js"><link rel="prefetch" href="/assets/js/32.128041a3.js"><link rel="prefetch" href="/assets/js/33.90a80a82.js"><link rel="prefetch" href="/assets/js/34.640d5210.js"><link rel="prefetch" href="/assets/js/35.dd6a5277.js"><link rel="prefetch" href="/assets/js/36.af0fb7fb.js"><link rel="prefetch" href="/assets/js/37.6282d3d3.js"><link rel="prefetch" href="/assets/js/38.09c22a9c.js"><link rel="prefetch" href="/assets/js/39.34118569.js"><link rel="prefetch" href="/assets/js/4.004aaf89.js"><link rel="prefetch" href="/assets/js/40.42fb5da5.js"><link rel="prefetch" href="/assets/js/41.d1ac92f4.js"><link rel="prefetch" href="/assets/js/42.046bbbbf.js"><link rel="prefetch" href="/assets/js/43.86ac5d2f.js"><link rel="prefetch" href="/assets/js/44.1393eed1.js"><link rel="prefetch" href="/assets/js/45.a4121f00.js"><link rel="prefetch" href="/assets/js/46.f78d075f.js"><link rel="prefetch" href="/assets/js/47.02e428da.js"><link rel="prefetch" href="/assets/js/48.3f9d12a6.js"><link rel="prefetch" href="/assets/js/49.bb9c3fab.js"><link rel="prefetch" href="/assets/js/5.8a61fa12.js"><link rel="prefetch" href="/assets/js/50.ebb028fd.js"><link rel="prefetch" href="/assets/js/51.a2b343de.js"><link rel="prefetch" href="/assets/js/52.2a464137.js"><link rel="prefetch" href="/assets/js/53.54a07d54.js"><link rel="prefetch" href="/assets/js/54.72acf66d.js"><link rel="prefetch" href="/assets/js/55.6168cc1a.js"><link rel="prefetch" href="/assets/js/56.0653a59a.js"><link rel="prefetch" href="/assets/js/57.df56ec02.js"><link rel="prefetch" href="/assets/js/58.fc8f11bc.js"><link rel="prefetch" href="/assets/js/59.158abf7b.js"><link rel="prefetch" href="/assets/js/6.1fda51af.js"><link rel="prefetch" href="/assets/js/60.10f7e3a6.js"><link rel="prefetch" href="/assets/js/61.844ecd3b.js"><link rel="prefetch" href="/assets/js/62.da039f8c.js"><link rel="prefetch" href="/assets/js/63.f2fe69a7.js"><link rel="prefetch" href="/assets/js/64.b9085bd9.js"><link rel="prefetch" href="/assets/js/65.6c182c91.js"><link rel="prefetch" href="/assets/js/66.e0d48b84.js"><link rel="prefetch" href="/assets/js/7.eca4725c.js"><link rel="prefetch" href="/assets/js/8.2504867c.js"><link rel="prefetch" href="/assets/js/9.64046c51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.757cca11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cold Elm Coders</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link router-link-active">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link router-link-active">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Blazor Database Application</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Building-a-Database-Application-in-Blazor/" aria-current="page" class="sidebar-link">Building a Database Application in Blazor</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html" aria-current="page" class="active sidebar-link">Part 1 - A Blazor Database Template - Project Structure and Framework</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#repository-and-database" class="sidebar-link">Repository and Database</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#design-philosophy" class="sidebar-link">Design Philosophy</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#solution-structure" class="sidebar-link">Solution Structure</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#libraries" class="sidebar-link">Libraries</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#data-classes" class="sidebar-link">Data Classes</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#ui-domain" class="sidebar-link">UI Domain</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#blazor-database-project" class="sidebar-link">Blazor.Database Project</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#blazor-database-web-project" class="sidebar-link">Blazor.Database.Web Project</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#wrap-up" class="sidebar-link">Wrap Up</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#history" class="sidebar-link">History</a></li></ul></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html" class="sidebar-link">Part 2 - Building the Services</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html" class="sidebar-link">Part 3 - Building Edit and View UI Components</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-4.html" class="sidebar-link">Part 4 - UI Components</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-5.html" class="sidebar-link">Part 5 - View Components - CRUD List Operations in the UI</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-6.html" class="sidebar-link">Part 6 - Adding new Record Types and Their UI to the Weather Application</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="building-a-database-application-in-blazor"><a href="#building-a-database-application-in-blazor" class="header-anchor">#</a> Building a Database Application in Blazor</h1> <h1 id="part-1-project-structure-and-framework"><a href="#part-1-project-structure-and-framework" class="header-anchor">#</a> Part 1 - Project Structure and Framework</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>These articles are currently being updated.  Most of the text and code is correct, but...</p></div> <p>This set of articles describes a framework for building and structuring Database Applications in Blazor.</p> <p>It's just a framework.  I make no recommendations: use it or abuse it.  It's what I use.  It's lightly opinionated: using out-of-the-box Blazor/Razor/DotNetCore systems and toolkits wherever possible.  The CSS framework is a lightly customized version of BootStrap.</p> <p>There are five articles describing various aspects of the framework and coding patterns used:</p> <ol><li>Project Structure and Framework - a bit of an introduction.</li> <li>Services - Building CRUD Data Layers.</li> <li>View Components - CRUD Edit and View Operations in the UI.</li> <li>UI Components - Building HTML/CSS Controls.</li> <li>View Components - CRUD List Operations in the UI.</li></ol> <p>The articles have changed drastically since their original release:</p> <ol><li>The whole framework is less opinionated.  I've dropped many of the more radical approaches to some issues in Blazor/SPAs.</li> <li>The libraries have been re-organised so Server and WASM projects can co-exist.</li> <li>Everything has been updated to Net5.</li> <li>The Repo home has moved.</li> <li>Server and WASM SPAs are now hosted and run from the same site.</li></ol> <p>These articles are not:</p> <ol><li>An attempt to define best practice.</li> <li>The finished product.</li></ol> <p>This first article proves an overview of the framework and solution architecture, and my reasons for making certain design decisions.</p> <h2 id="repository-and-database"><a href="#repository-and-database" class="header-anchor">#</a> Repository and Database</h2> <p>The repository for the articles has moved to <a href="https://github.com/ShaunCurtis/Blazor.Database" target="_blank" rel="noopener noreferrer">Blazor.Database Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  All previous repos are obselete and will be removed shortly.</p> <p>There's a SQL script in /SQL in the repository for building the database.</p> <p>The demo site has changed now the Server and WASM have been combined.  The site starts in Server mode - <a href="https://cec-blazor-database.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://cec-blazor-database.azurewebsites.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="design-philosophy"><a href="#design-philosophy" class="header-anchor">#</a> Design Philosophy</h2> <p>The high level application design looks like this:</p> <p><img src="/siteimages/Articles/Database/Basic-App-Design.png" alt="Basic Application Design"></p> <p>This may look too complex for a simple application, why not just grab the data from the datasource in the display page.  Up to you, but you (or someone else who has to maintain the code) will almost certainly regret that decision at some point.</p> <p><em>UI</em> and <em>Data</em> Domains are pretty self explanatory, but what exactly is the <em>Core Domain</em>?</p> <p>It's all the code that makes your application unique.  It's the business logic that processes the raw data from the data store and the logic that takes user input and stores sensible data from it.  The point is you should de-couple all this code from the data source and the UI.  Get it right and you can change the data store or the front end with little or no impact on the core application.</p> <h2 id="solution-structure"><a href="#solution-structure" class="header-anchor">#</a> Solution Structure</h2> <p>The application is configured to build and deploy both Server and WASM versions of the SPA, and host both on the same web site.  The solution is broken down into a number of projects based on:</p> <ol><li>Split between generic library code that can be across multiple solutions, and application specific code.</li> <li>Split to ensure separation of concerns.  The core application code in <em>Blazr.Database.Core</em> only has a dependancy on the <em>Blazr.SPA</em> library.</li> <li>Split because of incompatibles between project types.  A WASM project can't depend or be compiled with a <em>Microsoft.ASPNetCore.App</em> framework project.  API controllers need to be compiled within the <em>Microsoft.ASPNetCore.App</em> framework.</li></ol> <p>The result are a set of projects as follows:</p> <ol><li><em>Razr.SPA</em> - cross application re-usable code.</li> <li><em>Razr.UIComponents</em> - cross application re-usable UI components.</li> <li><em>Razr.Database.Core</em> - Core Domain code specific to the application.</li> <li><em>Razr.Database.Data</em> - Data Domain code specific to the application.</li> <li><em>Razr.Database.UI</em> - UI Domain -  components/forms/pages - specific to the application.</li> <li><em>Razr.Database.Controllers</em> - API controllers specific to the application.</li> <li><em>Razr.Database</em> - Blazor project to buid the WASM application code.</li> <li><em>Razr.Database.Web</em> - the web server applicaton.</li></ol> <p><img src="/siteimages/Articles/Database/Project-dependencies.png" alt="Project Dependancies"></p> <p>There are also testing projects currently being developed.</p> <p>You may have noticed at this point that there's no Blazor Server project.  You don't need one, you will see why later.</p> <h2 id="libraries"><a href="#libraries" class="header-anchor">#</a> Libraries</h2> <p>There are two resource libraries - <em>Razor.SPA</em> and <em>Razor.UIComponents</em>.</p> <p><em>Razor.SPA</em> has four namespaces:</p> <ol><li><em>Razor.SPA.Data</em> for all Data Domain code.</li> <li><em>Razor.SPA.Core</em> for all Core Domain code.</li> <li><em>Razor.SPA.Components</em> for all UI Domain code.</li> <li><em>Razor.SPA</em> for any code not in these categories.</li></ol> <p>All the code in <em>Razor.UIComponents</em> is in the UI Domain.</p> <h2 id="data-classes"><a href="#data-classes" class="header-anchor">#</a> Data Classes</h2> <p>All the data classes reside in the Core Domain and are thus in the <em>Razr.Database.Core</em> project. The database/datasets are specific to the project so the Data Interface and the Core Application datasets match.  In other projects you may need a set Data Domain datasets and a mapping processes to build the Core Domain data classes.</p> <p>Data is divided into three object types:</p> <ol><li><p><strong>Model Records</strong> - these are immutable records and represent a single table or view in the database.  Brokers and Connectors work with Model Records.  All model classes implement an <code>IDbRecord</code> interface.</p></li> <li><p><strong>Compound Records</strong> - these are immutable records based on a Model Record, but contain processed data and/or data from other model records associated with the main model record.</p></li> <li><p><strong>Edit Model Classes</strong> - these are editable versions of model records.  They contain logic to track, validate and build model records to save.  All edit classes implement <code>IEditRecord</code>, and optionally <code>IValidation</code> interfaces</p></li></ol> <h3 id="the-data-access-and-core-projects"><a href="#the-data-access-and-core-projects" class="header-anchor">#</a> The Data Access and Core Projects</h3> <p>The design:</p> <ol><li>Standardises the interfaces between the Data Domain and the underlying data storage,</li> <li>Standardises the interfaces between the Data Domain and the Core Domain.</li> <li>Make the domains testable.</li> <li>Use naming conventions to provide abstraction.  Model classes have the same names as <code>DbSets</code> or <code>DataSets</code>.</li></ol> <p><img src="/siteimages/articles/database/Data-Pipeline.png" alt="Data Pipeline"></p> <h4 id="data-stores"><a href="#data-stores" class="header-anchor">#</a> Data Stores</h4> <p>There are three data stores the application can use.</p> <ol><li><p>MS SQL database accessed through Entity Framework.  The connection string defined in <code>AppSettings</code>.  The database is accessed through a <code>DbContext</code> class <code>MSSQLWeatherDbContext</code>.  The <code>DbContext</code> services are created through a DBContextFactory implemented through the <code>AddDBContextFactory</code> service extension.  The application accesses the database using the <code>IDbContextFactory&lt;TDbContext&gt;</code> interface.</p></li> <li><p>SQLite in-memory database accessed through Entity Framework.  The connection string defined in <code>AppSettings</code>.  The database is accessed through a <code>DbContext</code> class <code>SQLiteWeatherDbContext</code>.  There is a single DbContext, which can cause issues.  This datastore is only for unit testing.</p></li> <li><p>Custom In-Memory Data Store.  This is a lightweight SQL style data store.  It's accessed through the <code>InMemoryWeatherDataStore</code> service.</p></li></ol> <h4 id="brokers"><a href="#brokers" class="header-anchor">#</a> Brokers</h4> <p><em>Brokers</em> provide the application interface for the data stores.  They reside in the Data Domain, but the IDataBroker interface definition is in the Core Domain.  The <em>DataBroker</em> is responsible for standard CRUDL - Create/Read/Update/Delete/List - actions against database entities.</p> <p>The following brokers are defined in <em>Blazr.SPA</em>, implementing a set of generics based boilerplate code.</p> <p><code>IDataBroker</code> defines the common interface, implementing CRUDL in Database language terminology.  Method names reflect the terminology used in the underlying data storage - Select, Update, Insert,...  <em>Blazr.SPA</em></p> <p><code>BaseDataBroker</code> provides an abstract base implementation of the interface. <em>Blazr.SPA</em></p> <p><code>SQLServerDataBroker</code> interfaces with the SQL EF database context used by Blazor Server and the API controller.</p> <p><code>SQLiteServerDataBroker</code> interfaces with the SQLite EF database context used by Blazor Server and the API controller.</p> <p><code>InMemoryDataStoreBroker</code> interfaces with the in memory data store context used by Blazor Server and the API controller.</p> <p><code>APIDataBroker</code> provides the API based data broker for Blazor WebAssembly.</p> <p>These brokers implement generics using <code>TRecord</code> to represent the record class.  The EF methods use <code>GetDbSet</code>, a  <code>DbContext</code> extension method, to return the <code>DbSet</code> object for <code>TRecord</code>.  The datastore has a similar function to get the <code>DataSet</code> for the <code>TRecord</code>.</p> <p>The Core Domain defines three data Brokers:</p> <ol><li><code>WeatherMSSQLDataBroker</code></li> <li><code>WeatherSQLiteDataBroker</code></li> <li><code>WeatherInMemoryDataBroker</code></li></ol> <p>The <code>WeatherSQLDataBroker</code> implemented in <em>Blazr.Database.Data</em> looks like this, and demonstrates the level of abstraction and boilerplating achieved:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherSQLDataBroker</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">ServerDataBroker<span class="token punctuation">&lt;</span>MSSQLWeatherDbContext<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">WeatherSQLDataBroker</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">IDbContextFactory<span class="token punctuation">&lt;</span>MSSQLWeatherDbContext<span class="token punctuation">&gt;</span></span> dbContext<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> dbContext<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="connectors"><a href="#connectors" class="header-anchor">#</a> Connectors</h4> <p>Connectors provide the data interface between the Core Domain and Data Brokers in the Data Domain.</p> <p><code>IDataServiceConnector</code> defines the common interface, implmementing CRUDL in more normal programming terminology - get, save, update, ...</p> <p><code>ModelDataServiceConnector</code> implements the interface using generics to provide a abstract connector to any data source.</p> <p>These classes/intefaces are generic and defined in <em>Blazr.SPA</em>.</p> <p>A single application specific Connector, <code>WeatherDataServiceConnector</code>, is declared in the application Core Domain.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherDataServiceConnector</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ModelDataServiceConnector</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">WeatherDataServiceConnector</span><span class="token punctuation">(</span><span class="token class-name">IDataBroker</span> dataBroker<span class="token punctuation">,</span> <span class="token class-name">ILoggingBroker</span> loggingBroker<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>dataBroker<span class="token punctuation">,</span> loggingBroker<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="viewservices"><a href="#viewservices" class="header-anchor">#</a> ViewServices</h4> <p>View Services provide the connection between the UI and the application data store.  They reside in the Core Domain and contain all the business and UI logic.  There are three types:</p> <ol><li>ModelViewServices - these expose single base model data to the UI.</li> <li>CompoundModelServics - these expose complex models built from base models.  An example would be a weather station and its associated daily weather station data.</li> <li>EditModelServices - these transform record data into editable model classes and expose and manage the edit process.</li></ol> <p>In the <em>Razr.SPA</em> Library:</p> <ol><li><code>IModelViewService</code> defines the interface for standard model view services</li> <li><code>BaseModelViewService</code> defining an abstract implementation.</li></ol> <p>In the application <code>WeatherForecastViewService</code> contains the data required by the UI to List/View/Edit the weather data.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastViewService</span> <span class="token punctuation">:</span> 
    <span class="token type-list"><span class="token class-name">BaseModelViewService<span class="token punctuation">&lt;</span>WeatherForecast<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> 
    <span class="token class-name">IModelViewService<span class="token punctuation">&lt;</span>WeatherForecast<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">WeatherForecastViewService</span><span class="token punctuation">(</span><span class="token class-name">IDataServiceConnector</span> dataServiceConnector<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>dataServiceConnector<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ui-domain"><a href="#ui-domain" class="header-anchor">#</a> UI Domain</h2> <p>The UI is structured to use re-usable components built in Razor/Html markup across an application, with the majority of the code in the base library.</p> <p><em>Page</em> is a much misused term in SPAs: frameworks could and should have introduced some new terminology.  I only use the <em>Pages</em> directory for real web pages, and <em>Page</em> to describe a web page served by a web server.  SPAs aren't web sites.  Programmers need to step outside the web page paradigm to understand how they work.  The Blazor UI is component based; to think of it containing <em>Pages</em> perpetuates the paradigm, and with it a lot of misconceptions.  The only web page in a SPA is the launch page.  Once the SPA launches, the application changes out components to transition between Views.  I've built an SPA with no router or Urls in sight - just like a desktop application.</p> <p>I use the following terminology thoughout these articles:</p> <ol><li>Page - the launch web page on the web site.  The only page in an SPA.</li> <li>RouteView/Routed Component.  These are all terms used by various people describing the pseudo page.  I use the term RouteViews.  This is the content displayed in the content section of a Layout, and normally determined by a defined route.  A <em>Route</em> deson't load a page, it loads a RouteView which is a component.  We'll look at these in more detail later in this article.</li> <li>Forms.  Forms are logical collections of controls that are either displayed in a view or a modal dialog.  Lists, view forms, edit forms are all classic forms. Forms contain controls not HTML.</li> <li>Controls.  Controls are components that display something: they emit HTML code to the Renderer.  For example, an edit box, a dropdown, button, ... A Form is a collection of controls.</li></ol> <p><img src="/siteimages/Articles/Database/UI-Pipeline.png" alt="UI Pipeline"></p> <h3 id="pages"><a href="#pages" class="header-anchor">#</a> Pages</h3> <p>Pages are the web pages that act as the host for the the application.  There's one per application.</p> <h3 id="routeviews"><a href="#routeviews" class="header-anchor">#</a> RouteViews</h3> <p>RouteViews are the components loaded into the root <code>App</code> component, normally by the Router through a Layout.  They don't have to be.  You can write your own View Manager, and you don't have to use Layouts.  The only two requirements for a View are:</p> <ol><li>It must be declared as a razor component or class implementing <code>IComponent</code>.</li> <li>It must declare one or more routes either through the <code>@page</code> directive or as a <code>RouteAttribute</code>.</li></ol> <p>The <code>FetchData</code> view is declared as shown below.  The Razor markup is mimimal, just the <code>WeatherForecastListForm</code>.  The code handles what happens on various actions in the List Form.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@page <span class="token string">&quot;/fetchdata&quot;</span>
<span class="token operator">&lt;</span><span class="token class-name">WeatherForecastListForm</span> EditRecord<span class="token operator">=</span><span class="token string">&quot;this.GoToEditor&quot;</span> ViewRecord<span class="token operator">=</span><span class="token string">&quot;this.GoToViewer&quot;</span> NewRecord<span class="token operator">=</span><span class="token string">&quot;this.GoToNew&quot;</span> ExitAction<span class="token operator">=</span><span class="token string">&quot;Exit&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>WeatherForecastListForm<span class="token operator">&gt;</span>
@code <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Inject</span></span><span class="token punctuation">]</span> <span class="token return-type class-name">NavigationManager</span> NavManager <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> _isWasm <span class="token operator">=&gt;</span> NavManager<span class="token punctuation">?.</span>Uri<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;wasm&quot;</span><span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>CurrentCultureIgnoreCase<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GoToEditor</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NavManager<span class="token punctuation">.</span><span class="token function">NavigateTo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;weather/edit/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GoToNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NavManager<span class="token punctuation">.</span><span class="token function">NavigateTo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;weather/edit/-1&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GoToViewer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NavManager<span class="token punctuation">.</span><span class="token function">NavigateTo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;weather/view/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_isWasm<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>NavManager<span class="token punctuation">.</span><span class="token function">NavigateTo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;/wasm&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>NavManager<span class="token punctuation">.</span><span class="token function">NavigateTo</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;/&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The purpose of the RouteView is to declare routes that the <code>Router</code> component can find when the SPA starts.  The root component <code>App</code> is shown below which declares the <code>Router</code> component.  <code>AppAssembly=&quot;@typeof(WeatherApp).Assembly&quot;</code> points the router to the assembly it browses to find route declarations.  In this case it's pointed to assembly containing the root component.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Router</span> <span class="token attr-name">AppAssembly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@typeof(WeatherApp).Assembly<span class="token punctuation">&quot;</span></span> <span class="token attr-name">PreferExactMatches</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Found</span> <span class="token attr-name">Context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routeData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouteView</span> <span class="token attr-name">RouteData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@routeData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">DefaultLayout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@typeof(WASMLayout)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Found</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NotFound</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LayoutView</span> <span class="token attr-name">Layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@typeof(WASMLayout)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Sorry, there's nothing at this address.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LayoutView</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NotFound</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Router</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The display component is called <code>RouteView</code> which it where my nomenclature comes from.</p> <p><strong>Note</strong> - In the application we will be replacing <code>RouteView</code> with a new <code>RouteViewManager</code>.</p> <h3 id="layouts"><a href="#layouts" class="header-anchor">#</a> Layouts</h3> <p>Layouts are out-of-the-box Blazor Layouts.  The Router renders the Layout with the <code>RouteView</code> as the child content.  There's a default <code>Layout</code> defined in the <code>Router</code> definition.  I'll skip layouts here, we've had them for a long while and they are adequately covered elsewhere.</p> <h3 id="forms"><a href="#forms" class="header-anchor">#</a> Forms</h3> <p>A form is a mid level unit in the component hierarchy.  RouteViews contain one or more forms.  You can see multiple forms declared in the <code>FetchdataInline</code> routeview.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@page <span class="token string">&quot;/fetchdataInline&quot;</span>

@<span class="token keyword">namespace</span> Blazr<span class="token punctuation">.</span>Database<span class="token punctuation">.</span>RouteViews
@inherits InlineFormBase

<span class="token operator">&lt;</span><span class="token class-name">UIComponent</span> Show<span class="token operator">=</span><span class="token string">&quot;this.ShowEditor&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">WeatherForecastEditorForm</span> ID<span class="token operator">=</span><span class="token string">&quot;this.editorId&quot;</span> ExitAction<span class="token operator">=</span><span class="token string">&quot;this.CloseDialog&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>WeatherForecastEditorForm<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UIComponent<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">UIComponent</span> Show<span class="token operator">=</span><span class="token string">&quot;this.ShowViewer&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">WeatherForecastViewerForm</span> ID<span class="token operator">=</span><span class="token string">&quot;this.viewerId&quot;</span> ExitAction<span class="token operator">=</span><span class="token string">&quot;this.CloseDialog&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>WeatherForecastViewerForm<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UIComponent<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token class-name">WeatherForecastListForm</span> EditRecord<span class="token operator">=</span><span class="token string">&quot;this.GoToEditor&quot;</span> ViewRecord<span class="token operator">=</span><span class="token string">&quot;this.GoToViewer&quot;</span> NewRecord<span class="token operator">=</span><span class="token string">&quot;this.GoToNew&quot;</span> ExitAction<span class="token operator">=</span><span class="token string">&quot;Exit&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>WeatherForecastListForm<span class="token operator">&gt;</span>
</code></pre></div><p>Forms are logical collections of controls that are either displayed in a view or a modal dialog.  Lists, view forms, edit forms are all classic forms. Forms contain controls not Html.</p> <h3 id="controls"><a href="#controls" class="header-anchor">#</a> Controls</h3> <p>A control is the low level component.  It's where the Html code is built.  Controls can contain other controls to build more complex controls.</p> <p>How often do you repeat the same Html code in a Razor component.  What you do in Razor you wouldn't dream of doing in C# code.  You'd write a helper method.  Why not do the same thing in components.</p> <div class="language-html extra-class"><pre class="language-html"><code>// mylist.razor
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>px-1 py-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
.... 10 times
</code></pre></div><p>may appear more complicated that:</p> <div class="language-html extra-class"><pre class="language-html"><code>// UiListRow.razor
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>px-1 py-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@childContent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>and:</p> <div class="language-html extra-class"><pre class="language-html"><code>// mylist.razor
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UiListRow</span><span class="token punctuation">&gt;</span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UiListRow</span><span class="token punctuation">&gt;</span></span>
.... 10 times
</code></pre></div><p>but changing the padding across the application is simple in the component approach and a pain in markup.</p> <div class="language-html extra-class"><pre class="language-html"><code>// UiListRow.razor
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>px-1 py-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@childContent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="blazor-database-project"><a href="#blazor-database-project" class="header-anchor">#</a> Blazor.Database Project</h2> <p>The Blazor.Database project contains all the project specific Blazor code plus the startup code and Web Assembly code for the WASM application.</p> <h3 id="program-cs"><a href="#program-cs" class="header-anchor">#</a> Program.cs</h3> <p><code>Program</code> is the entry point for the WASM application and contains the service definitions and reference to the root component.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebAssemblyHostBuilder<span class="token punctuation">.</span><span class="token function">CreateDefault</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span>RootComponents<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherApp<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddScoped</span><span class="token punctuation">(</span>sp <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span> <span class="token punctuation">{</span> BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>HostEnvironment<span class="token punctuation">.</span>BaseAddress<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddWASMApplicationServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RunAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Services for each project/library are specified in <code>IServiceCollection</code> Extensions.</p> <h4 id="servicecollectionextensions-cs"><a href="#servicecollectionextensions-cs" class="header-anchor">#</a> ServiceCollectionExtensions.cs</h4> <p>There are methods for site specific services and a <code>AddCommonServices</code> method to cover all the services common to WASM and Server modes.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceCollectionExtensions</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IServiceCollection</span> <span class="token function">AddWASMApplicationServices</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDataBroker<span class="token punctuation">,</span> APIDataBroker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">AddCommonServices</span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> services<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IServiceCollection</span> <span class="token function">AddServerApplicationServices</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token comment">// Local DB Setup</span>
            <span class="token class-name"><span class="token keyword">var</span></span> dbContext <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;Configuration:DBContext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContextFactory</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MSSQLWeatherDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>dbContext<span class="token punctuation">)</span><span class="token punctuation">,</span> ServiceLifetime<span class="token punctuation">.</span>Singleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDataBroker<span class="token punctuation">,</span> WeatherSQLDataBroker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">AddCommonServices</span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> services<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddCommonServices</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RouteViewService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ILogger<span class="token punctuation">,</span> Logger<span class="token punctuation">&lt;</span>LoggingBroker<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ILoggingBroker<span class="token punctuation">,</span> LoggingBroker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDateTimeBroker<span class="token punctuation">,</span> DateTimeBroker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDataServiceConnector<span class="token punctuation">,</span> ModelDataServiceConnector<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecastViewService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RandomNumberService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DummyWeatherService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>The final setup on the WASM project is to set the <code>StaticWebAssetBasePath</code> in the project file.  This will let us run the WASM and Server version together on the <em>Web</em> project.</p> <div class="language-xml extra-class"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>net5.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>StaticWebAssetBasePath</span><span class="token punctuation">&gt;</span></span>WASM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>StaticWebAssetBasePath</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="css"><a href="#css" class="header-anchor">#</a> CSS</h3> <p>All CSS is shared, so lives in <code>Blazor.Database.Web</code>.  I use Bootstrap, customized a little with SASS.  The <em>WEB COMPILER</em> extension is installed in Visual Studio to compile SASS files on the fly.</p> <h2 id="blazor-database-web-project"><a href="#blazor-database-web-project" class="header-anchor">#</a> Blazor.Database.Web Project</h2> <h3 id="css-2"><a href="#css-2" class="header-anchor">#</a> CSS</h3> <p>The project uses a SCSS to build a custom version of Bootstrap, with some colour and small formatting differences.  I'll not cover the setup here - search <em>shaun curtis blazor css frameworks</em> to find an article I've written on the subject.</p> <h4 id="pages-2"><a href="#pages-2" class="header-anchor">#</a> Pages</h4> <p>We have two real pages - the standard issue <code>_Host.cshtml</code> for starting the Blazor Server SPA and <code>_WASM.cshtml</code> to start the WASM SPA.</p> <h4 id="host-cshtml"><a href="#host-cshtml" class="header-anchor">#</a> _Host.cshtml</h4> <p>Standard Blazor Server startup page.  Note:</p> <ol><li>The stylesheet references to the custom CSS and the component CSS.</li> <li>The <em>blazor.server.js</em> file script reference.</li> <li>The <code>component</code> reference to the root component - in this case <code>Blazor.Database.Server.Components.WeatherApp</code>.  The root coponent is in the <em>Blazor.Database</em> library.</li></ol> <div class="language-html extra-class"><pre class="language-html"><code>@page &quot;/&quot;
@namespace Blazor.Database.Web.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = null;
}

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Blazor.Database.Web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>css/site.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Blazor.Database.Web.styles.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/wasm/Blazor.Database.styles.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>typeof(Blazor.Database.Components.WeatherApp)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">render-mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ServerPrerendered<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>blazor-error-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Staging,Production<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            An error has occurred. This application may no longer respond until reloaded.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            An unhandled exception has occurred. See browser dev tools for details.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Reload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dismiss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>🗙<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_content/Blazor.SPA/site.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_framework/blazor.server.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="wasm-cshtml"><a href="#wasm-cshtml" class="header-anchor">#</a> _WASM.cshtml</h4> <p>This is just a server version of  WASM <em>index.html</em>*.</p> <ol><li>The same CSS references and the server file.</li> <li>The same <em>site.js</em>.</li> <li>The <code>&lt;base href&gt;</code> set to the WASM subdirectory.</li> <li><em>blazor.webassembly.js</em> referenced to the subdirectory.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@page <span class="token string">&quot;/WASM&quot;</span>
@<span class="token keyword">namespace</span> Blazor<span class="token punctuation">.</span>Database<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Pages
@addTagHelper <span class="token operator">*</span><span class="token punctuation">,</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">.</span>TagHelpers
@<span class="token punctuation">{</span>
    Layout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">meta</span> charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">meta</span> name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Blazor<span class="token punctuation">.</span>DataBase<span class="token punctuation">.</span>WASM<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">base</span> href<span class="token operator">=</span><span class="token string">&quot;/wasm/&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;/css/site.min.css&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> href<span class="token operator">=</span><span class="token string">&quot;/Blazor.Database.Web.styles.css&quot;</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> href<span class="token operator">=</span><span class="token string">&quot;/wasm/Blazor.Database.styles.css&quot;</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">div</span> id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;mt-4&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;margin-right:auto; margin-left:auto; width:100%;&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;loader&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">div</span> style<span class="token operator">=</span><span class="token string">&quot;width:100%; text-align:center;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>Web Application Loading<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">div</span> id<span class="token operator">=</span><span class="token string">&quot;blazor-error-ui&quot;</span><span class="token operator">&gt;</span>
        An unhandled error has occurred<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token class-name">a</span> href<span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;reload&quot;</span><span class="token operator">&gt;</span>Reload<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dismiss&quot;</span><span class="token operator">&gt;</span>🗙<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">script</span> src<span class="token operator">=</span><span class="token string">&quot;_content/Blazor.SPA/site.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">script</span> src<span class="token operator">=</span><span class="token string">&quot;/wasm/_framework/blazor.webassembly.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><h4 id="startup-cs"><a href="#startup-cs" class="header-anchor">#</a> Startup.cs</h4> <p>The local services and <code>Blazor.SPA</code> library services are added.  It:</p> <ol><li>Adds the Blazor Server side Services</li> <li>Configures two Middleware pathways, dependant on the Url.</li></ol> <p>I'll not go into detail here - you can read more about multi SPA hosting in a separate article - search <em>shaun curtis blazor hydra</em>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">Startup</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span><span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token function">AddServerSideBlazor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token function">AddControllersWithViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// services.AddApplicationServices(this.Configuration);</span>
        services<span class="token punctuation">.</span><span class="token function">AddInMemoryApplicationServices</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token comment">// Server Side Blazor doesn't register HttpClient by default</span>
        <span class="token comment">// Thanks to Robin Sue - Suchiman https://github.com/Suchiman/BlazorDualMode</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>services<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>ServiceType <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">HttpClient</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Setup HttpClient for server side in a client side compatible fashion</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HttpClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Creating the URI helper needs to wait until the JS Runtime is initialized, so defer it.</span>
                <span class="token class-name"><span class="token keyword">var</span></span> uriHelper <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavigationManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span>
                <span class="token punctuation">{</span>
                    BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>uriHelper<span class="token punctuation">.</span>BaseUri<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            app<span class="token punctuation">.</span><span class="token function">UseExceptionHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            app<span class="token punctuation">.</span><span class="token function">UseHsts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        app<span class="token punctuation">.</span><span class="token function">UseHttpsRedirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        app<span class="token punctuation">.</span><span class="token function">MapWhen</span><span class="token punctuation">(</span>ctx <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Path<span class="token punctuation">.</span><span class="token function">StartsWithSegments</span><span class="token punctuation">(</span><span class="token string">&quot;/WASM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> app1 <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            app1<span class="token punctuation">.</span><span class="token function">UseBlazorFrameworkFiles</span><span class="token punctuation">(</span><span class="token string">&quot;/wasm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            app1<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            app1<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                endpoints<span class="token punctuation">.</span><span class="token function">MapFallbackToPage</span><span class="token punctuation">(</span><span class="token string">&quot;/wasm/{*path:nonfile}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/_WASM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapBlazorHub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapFallbackToPage</span><span class="token punctuation">(</span><span class="token string">&quot;/Server/{*path:nonfile}&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/_Host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapFallbackToPage</span><span class="token punctuation">(</span><span class="token string">&quot;/_Host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="wrap-up"><a href="#wrap-up" class="header-anchor">#</a> Wrap Up</h2> <p>That wraps up this section.  It's a bit of an overview, with a lot more detail to come later.  Hopefully it demonstrates the level of abstraction you can achieve with Blazor projects.  The next section looks at Services and implementing the data layers.</p> <p>Some key points to note:</p> <ol><li>You can build your code with common code for Server and WASM projects.  With care you can write an application that can be deployed either way as is the case with this project.</li> <li>Both WASM and Server can be run from the same web site, and you can switch between the two.</li> <li>Be very careful about the terminology.  Understand the different meanings of &quot;Page&quot;.</li></ol> <p>If you're reading this article well into the future, check the readme in the repository for the latest version of the article set.</p> <h2 id="history"><a href="#history" class="header-anchor">#</a> History</h2> <ul><li>15-Sep-2020: Initial version</li> <li>17-Nov-2020: Major Blazor.CEC library changes.  Change to ViewManager from Router and new Component base implementation.</li> <li>26-Mar-2021: Major updates to Services, project structure and data editing</li> <li>24-June-2021: revisions to data layers.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Building-a-Database-Application-in-Blazor/" class="prev router-link-active">
        Building a Database Application in Blazor
      </a></span> <span class="next"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html">
        Part 2 - Building the Services
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e7504274.js" defer></script><script src="/assets/js/3.f3d70fce.js" defer></script><script src="/assets/js/23.9a2edb75.js" defer></script>
  </body>
</html>
