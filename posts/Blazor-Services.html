<!DOCTYPE html>
<html lang="en">
<head>
    
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- SEO Meta Tags -->
<meta name="description" content="Your description">
<meta name="author" content="Your name">

<!-- OG Meta Tags to improve the way the post looks when you share the page on Facebook, Twitter, LinkedIn -->
<meta property="og:site_name" content="" /> <!-- website name -->
<meta property="og:site" content="" /> <!-- website link -->
<meta property="og:title" content="" /> <!-- title shown in the actual shared post -->
<meta property="og:description" content="" /> <!-- description shown in the actual shared post -->
<meta property="og:image" content="" /> <!-- image link, make sure it's jpg -->
<meta property="og:url" content="" /> <!-- where do you want your post to link to -->
<meta name="twitter:card" content="summary_large_image"> <!-- to have large image post format in Twitter -->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<meta name="description" content="An examination of Blazor DI and Services," >
<meta name="author" content="Shaun Curtis" >



<title>Blazor Services</title>


<!-- Custom fonts for this template-->
<link href="/assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet">

<!-- Custom styles for this template-->
<link href="/assets/css/sb-admin-2.css" rel="stylesheet" type="text/css">
<link href="/assets/css/site.css" rel="stylesheet" type="text/css">

<!-- Favicon  -->
<link rel="icon" href="/assets/images/favicon.png">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
    <link rel="stylesheet" href="/assets/css/article.css" type="text/css">
</head>
<body id="page-top">
    <!--topbar-->
    <div id="topbar">
        
<!-- Topbar -->
<nav class="navbar navbar-expand navbar-light topbar mb-4 static-top">
    
<ul class="navbar-nav" >
<li class="nav-item" >
<a class="nav-link " href="/index.html" role="button"  >
<span class="mr-2 d-none d-lg-inline text-gray-100">Index</span>
</a>
</li>
<li class="nav-item dropdown no-arrow mx-1" >
<a class="nav-link dropdown-toggle" href="#" id="f0e2c4fb-bae0-47eb-afdc-f8bed749c990" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"  >
<span class="mr-2 d-none d-lg-inline text-gray-100">Articles</span>
</a>
<div class=" dropdown-list dropdown-menu shadow animated--grow-in" aria-labelledby="f0e2c4fb-bae0-47eb-afdc-f8bed749c990" >
<a class="dropdown-item" href="/articles/A-Flexible-App.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Creating a Dynamic Blazor App Component
</a>
<a class="dropdown-item" href="/articles/Async-Programming-in-DotNetCore.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Async Programming In Dotnetcore
</a>
<a class="dropdown-item" href="/articles/Blazor-AllinOne.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor All In One - Multi SPA Hosting
</a>
<a class="dropdown-item" href="/articles/Blazor-Async-Programming.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Async Programming
</a>
<a class="dropdown-item" href="/articles/Blazor-Brick-By-Brick.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Brick By Brick
</a>
<a class="dropdown-item" href="/articles/Blazor-Components.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Components
</a>
<a class="dropdown-item" href="/articles/Blazor-CSS.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor CSS
</a>
<a class="dropdown-item" href="/articles/Blazor-DataList-Control.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Datalist Control
</a>
<a class="dropdown-item" href="/articles/Blazor-Form-Validation.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Form Validation
</a>
<a class="dropdown-item" href="/articles/Building-Edit-Forms.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building Edit Forms
</a>
<a class="dropdown-item" href="/articles/EditFormState.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
The Blazor EditFormState Control
</a>
<a class="dropdown-item" href="/articles/Hydra.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Hydra
</a>
<a class="dropdown-item" href="/articles/Inline-Dialog.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
The Blazor Inline Dialog Control
</a>
<a class="dropdown-item" href="/articles/Modal-Dialog.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
A Blazor Modal Dialog
</a>
<a class="dropdown-item" href="/articles/ValidationFormState.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
A Blazor Validation Control
</a>
</div>
</li>
<li class="nav-item dropdown no-arrow mx-1" >
<a class="nav-link dropdown-toggle" href="#" id="1e2f15d1-19f0-46f7-93e1-1f31084bb2e5" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"  >
<span class="mr-2 d-none d-lg-inline text-gray-100">Blazor Database Apps</span>
</a>
<div class=" dropdown-list dropdown-menu shadow animated--grow-in" aria-labelledby="1e2f15d1-19f0-46f7-93e1-1f31084bb2e5" >
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building A Database Application In Blazor Part 1
</a>
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building A Database Application In Blazor Part 2
</a>
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building A Database Application In Blazor Part 3
</a>
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-4.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building A Database Application In Blazor Part 4
</a>
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-5.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building A Database Application In Blazor Part 5
</a>
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-6.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building A Database Application In Blazor Part 6
</a>
<a class="dropdown-item" href="/Building-a-Database-Application-in-Blazor/index.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Building a Database Application in Blazor
</a>
</div>
</li>
<li class="nav-item dropdown no-arrow mx-1" >
<a class="nav-link dropdown-toggle" href="#" id="d83d2f2b-f321-487e-96cb-9c2f2aabc5f1" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"  >
<span class="mr-2 d-none d-lg-inline text-gray-100">Design</span>
</a>
<div class=" dropdown-list dropdown-menu shadow animated--grow-in" aria-labelledby="d83d2f2b-f321-487e-96cb-9c2f2aabc5f1" >
<a class="dropdown-item" href="/Design/Clean-Design-In-Blazor.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Clean Design Principles in Blazor Applications
</a>
<a class="dropdown-item" href="/Design/Clean-Design-Blazor-Template.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
A Blazor Clean Design Template
</a>
<a class="dropdown-item" href="/Design/Clean-Design-Blazor-Template-Solution-Structure.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Solution Structure in the Clean Design Blazor Template
</a>
<a class="dropdown-item" href="/Design/Clean-Design-Blazor-Template-DataServices.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Data Services in the Clean Design Blazor Template
</a>
<a class="dropdown-item" href="/Design/Clean-Design-Blazor-Template-UI.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
The UI in the Clean Design Blazor Template
</a>
<a class="dropdown-item" href="/Design/Clean-Design-Blazor-Template-Solution-Setup.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Solution Setup in the Clean Design Blazor Template
</a>
<a class="dropdown-item" href="/Design/Clean-Design-Blazor-Template-Testing.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Testing in the Clean Design Blazor Template
</a>
</div>
</li>
<li class="nav-item dropdown no-arrow mx-1" >
<a class="nav-link dropdown-toggle" href="#" id="9db0a694-03e1-43e3-aa63-325df7409779" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"  >
<span class="mr-2 d-none d-lg-inline text-gray-100">Modern C#</span>
</a>
<div class=" dropdown-list dropdown-menu shadow animated--grow-in" aria-labelledby="9db0a694-03e1-43e3-aa63-325df7409779" >
<a class="dropdown-item" href="/Modern-Coding-Patterns/Nullable-And-VS-2022.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Nullable And VS 2022
</a>
</div>
</li>
<li class="nav-item dropdown no-arrow mx-1" >
<a class="nav-link dropdown-toggle" href="#" id="0942065b-7dfe-4bb4-af04-bd3b49812164" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"  >
<span class="mr-2 d-none d-lg-inline text-gray-100">Posts</span>
</a>
<div class=" dropdown-list dropdown-menu shadow animated--grow-in" aria-labelledby="0942065b-7dfe-4bb4-af04-bd3b49812164" >
<a class="dropdown-item" href="/posts/Blazor-Async-UI-Events.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Async UI Events
</a>
<a class="dropdown-item" href="/posts/Blazor-Bootstrap-Toaster.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Bootstrap Toaster
</a>
<a class="dropdown-item" href="/posts/Blazor-Services.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Services
</a>
<a class="dropdown-item" href="/posts/DBContexts-In-Transient-Services.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Dbcontexts In Transient Services
</a>
<a class="dropdown-item" href="/posts/DynamicCss.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Blazor Dynamic Stylesheets
</a>
<a class="dropdown-item" href="/posts/For-ForEach-in-Blazor.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
For Foreach In Blazor
</a>
<a class="dropdown-item" href="/posts/Notification-Service-Pattern.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
Notification Service Pattern
</a>
<a class="dropdown-item" href="/posts/The-Blazor-WASM-Hosted-Project.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
The Blazor WASM Hosted Project
</a>
<a class="dropdown-item" href="/posts/XML-XSD-Serialization.html" >
<i class="fas fa-file-alt fa-sm fa-fw mr-2 text-gray-600"></i>
XML XSD Serialization
</a>
</div>
</li>
</ul>

    <div class="ms-5 me-5 ml-auto">
        <h1>Cold Elm Coders</h1>
    </div>
</nav>


    </div>
    <!--End topbar-->
    <!--Sidebar-->
    <div id="sidebar">
        
<div class="article-info p-2" Published: 04-01-2022 >
<div>Published: 04-01-2022</div>
<div>Last Updated: 04-01-2022</div>
<div>Author: Shaun Curtis</div>
</div>

        
<h4 class="p-2">Table of Contents</h4>
<ul class="TOC" >
<li class="TOC-item TOC-item-0" >
<a class="TOC-link" href="#">Top</a>
<ul class="TOC TOC-0" >
<li class="TOC-item TOC-item-1" >
<ul class="TOC TOC-1" >
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#dependancy-injection-containers">Dependancy Injection Containers</a>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#building-a-teast-environment">Building a Teast Environment</a>
<ul class="TOC TOC-2" >
<li class="TOC-item TOC-item-3" >
<a class="TOC-link" href="#project">Project</a>
</li>
<li class="TOC-item TOC-item-3" >
<a class="TOC-link" href="#services">Services</a>
</li>
<li class="TOC-item TOC-item-3" >
<a class="TOC-link" href="#component">Component</a>
</li>
</ul>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#testing">Testing</a>
<ul class="TOC TOC-2" >
<li class="TOC-item TOC-item-3" >
<a class="TOC-link" href="#the-logs">The Logs</a>
</li>
<li class="TOC-item TOC-item-3" >
<a class="TOC-link" href="#solutions-to-the-transient-idisposable-issue">Solutions to the Transient <code>IDisposable</code> Issue</a>
</li>
</ul>
</li>
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#wrap-up">Wrap Up</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
    <!--End Sidebar-->
    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <div id="article">
                    <!-- Article -->
                    
<!-- Header -->
<header class="ex-header-article">
    <div class="container">
        <div class="row pt-3 pb-3 border-bottom">
            <div class="col">
                
<h1>Blazor Services</h1>
<div>An examination of Blazor DI and Services,</div>

            </div> <!-- end of col -->
        </div> <!-- end of row -->
    </div> <!-- end of container -->
</header> <!-- end of ex-header -->
<!-- end of header -->


                    
<!-- Article Container -->
<div class="ex-basic-1 pt-4">
    <div class="container">
        <div class="row">
            <div class="col-12">
                

        <p>This post looks at Blazor the Dependancy Injection Containers and examines the lifecycle of the services they provide.</p>
<h2 id="dependancy-injection-containers">Dependancy Injection Containers</h2>
<p>Blazor has three levels of service containers.  These are:</p>
<p>Application Service Container.  This is held by the running instance of DotNetCore.  In the Blazor Server Context the <code>WebApplication</code>.  This contains all the Singleton Services.</p>
<p>Blazor Hub Service Container.  This is held by the Blazor Hub Session for the running SPA: one per user Hub session.  This contains the normal Scoped and Transient Services.</p>
<p>Blazor Component/Class Container.  This is held by the instance of OwningComponentBase or other class that implements a Service Container.  This contains any specified Scoped or Transient Services.</p>
<p>Some points to note:</p>
<ol>
<li>The Service registration process in Startup/Program defines the services, and the configuration of those services, that can be instantiated in DI service containers.</li>
<li>You can instantiate services in a lower level container from a higher level container.  A service in a Hub Session container can instantiate with a reference to a Singleton service instance in the application container, as can one in a &quot;Owning&quot; container reference a service in the Hub session container.</li>
<li>You can create a DI Container in any class you wish.  Use the code from <code>OwningComponentBase</code> as a template.</li>
</ol>
<p>To examine the behaviour of the Services we need a Blazor Application.</p>
<h2 id="building-a-teast-environment">Building a Teast Environment</h2>
<h3 id="project">Project</h3>
<p>Add a Blazor Server template project.</p>
<h3 id="services">Services</h3>
<p>Add the following classes to a new <em>Services</em> folder:</p>
<pre><code class="language-csharp"><div><span class="hljs-keyword">namespace</span> <span class="hljs-title">Blazr</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TransientService</span> : <span class="hljs-title">IDisposable</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> Guid Id = Guid.NewGuid();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TransientService</span>(<span class="hljs-params"></span>)</span>
    {
        Debug.WriteLine(<span class="hljs-string">$&quot;New Instance <span class="hljs-subst">{<span class="hljs-keyword">this</span>.GetType().Name}</span> - <span class="hljs-subst">{Id.ToString()}</span>&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Dispose</span>(<span class="hljs-params"></span>)</span>
    =&gt; Debug.WriteLine(<span class="hljs-string">$&quot;Disposing <span class="hljs-subst">{<span class="hljs-keyword">this</span>.GetType().Name}</span> - <span class="hljs-subst">{Id.ToString()}</span>&quot;</span>);
}
</div></code></pre>
<pre><code class="language-csharp"><div><span class="hljs-keyword">namespace</span> <span class="hljs-title">Blazr</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingletonService</span> : <span class="hljs-title">IDisposable</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> Guid Id = Guid.NewGuid();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SingletonService</span>(<span class="hljs-params"></span>)</span> 
    {
        Debug.WriteLine(<span class="hljs-string">$&quot;New Instance <span class="hljs-subst">{<span class="hljs-keyword">this</span>.GetType().Name}</span> - <span class="hljs-subst">{Id.ToString()}</span>&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Dispose</span>(<span class="hljs-params"></span>)</span>
    =&gt; Debug.WriteLine(<span class="hljs-string">$&quot;Disposing <span class="hljs-subst">{<span class="hljs-keyword">this</span>.GetType().Name}</span> - <span class="hljs-subst">{Id.ToString()}</span>&quot;</span>);
}
</div></code></pre>
<pre><code class="language-csharp"><div><span class="hljs-keyword">namespace</span> <span class="hljs-title">Blazr</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ScopedService</span> : <span class="hljs-title">IDisposable</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> Guid Id = Guid.NewGuid();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> SingletonService SingletonService;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ScopedService</span>(<span class="hljs-params">SingletonService singletonService</span>)</span>
    {
        SingletonService = singletonService;
        Debug.WriteLine(<span class="hljs-string">$&quot;New Instance <span class="hljs-subst">{<span class="hljs-keyword">this</span>.GetType().Name}</span> - <span class="hljs-subst">{Id.ToString()}</span>&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Dispose</span>(<span class="hljs-params"></span>)</span>
    =&gt; Debug.WriteLine(<span class="hljs-string">$&quot;Disposing <span class="hljs-subst">{<span class="hljs-keyword">this</span>.GetType().Name}</span> - <span class="hljs-subst">{Id.ToString()}</span>&quot;</span>);
}
</div></code></pre>
<p>Add these services to the the application services:</p>
<pre><code class="language-csharp"><div><span class="hljs-comment">// Add services to the container.</span>
builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();
builder.Services.AddSingleton&lt;WeatherForecastService&gt;();
builder.Services.AddSingleton&lt;SingletonService&gt;();
builder.Services.AddScoped&lt;ScopedService&gt;();
builder.Services.AddTransient&lt;TransientService&gt;();
</div></code></pre>
<h3 id="component">Component</h3>
<p>Add <em>/Components/ServicesComponent.razor</em></p>
<pre><code class="language-csharp"><div>@inherits OwningComponentBase&lt;ScopedService&gt;
@namespace Blazr
@using Microsoft.AspNetCore.Components.Web;

&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;bg-light p-3&quot;</span>&gt;
    &lt;h1&gt;Hello Blazor at @(time.ToLongTimeString())&lt;/h1&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;m-3&quot;</span>&gt;
        Todays Message <span class="hljs-keyword">is</span> : @Message
    &lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;m-3&quot;</span>&gt;
        &lt;button <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span> @onclick=<span class="hljs-string">&quot;GetTime&quot;</span>&gt;Set Time&lt;/button&gt;
    &lt;/div&gt;
    &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;Container-fluid&quot;</span>&gt;
        &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;row bg-secondary text-white&quot;</span>&gt;
            &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;col-6 text-start&quot;</span>&gt;
                Singleton Service Id : @this.singletonService!.Id.ToString()&lt;br /&gt;
                Scoped Service Id : @this.scopedService!.Id.ToString()&lt;br /&gt;
                Transient Service Id : @this.transientService!.Id.ToString()&lt;br /&gt;
            &lt;/div&gt;
            &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;col-6 text-start&quot;</span>&gt;
                Owned Scoped Singleton Service Id : @this.Service.SingletonService.Id.ToString()&lt;br /&gt;
                Owned Scoped Service Id : @this.Service.Id.ToString()&lt;br /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

@code {
    [<span class="hljs-meta">Parameter</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [<span class="hljs-meta">Inject</span>] <span class="hljs-keyword">private</span> SingletonService? singletonService { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">Inject</span>] <span class="hljs-keyword">private</span> ScopedService? scopedService { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">Inject</span>] <span class="hljs-keyword">private</span> TransientService? transientService { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">private</span> DateTime time = DateTime.Now;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnInitialized</span>(<span class="hljs-params"></span>)</span>
    =&gt; time = DateTime.Now;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GetTime</span>(<span class="hljs-params"></span>)</span>
    =&gt; time = DateTime.Now;
}
</div></code></pre>
<p>Finally update <em>index.razor</em>: add the <code>ServicesComponent</code></p>
<pre><code class="language-csharp"><div>@page <span class="hljs-string">&quot;/&quot;</span>

&lt;PageTitle&gt;Index&lt;/PageTitle&gt;

&lt;h1&gt;Hello, world!&lt;/h1&gt;

Welcome to your <span class="hljs-keyword">new</span> app.

&lt;ServicesComponent Message=<span class="hljs-string">&quot;This is a Test Blazor Component&quot;</span> /&gt;
</div></code></pre>
<h2 id="testing">Testing</h2>
<p>Run the project and examine the Debug Console.</p>
<h3 id="the-logs">The Logs</h3>
<p>The first section is the pre-render of the page by the server - this is the Index page.</p>
<p>The only surviving service is the Singleton 7765.</p>
<pre><code><code><div>New Instance SingletonService - 77655d43-53ce-484e-bb60-3a61d2a92412
New Instance ScopedService - 81895945-1e7d-400f-a15b-fb853bd62de4
New Instance TransientService - f76d6dad-8493-4401-ba75-5ba5d153a686
New Instance TransientService - beba3fd1-fa4d-47e1-8291-d2a33166d6d3
New Instance ScopedService - 8b965aa9-22b2-4061-88a4-ac3893d95a31
New Instance ScopedService - b436f1b0-ef28-4f35-8780-8dca3bc6365b
Disposing TransientService - beba3fd1-fa4d-47e1-8291-d2a33166d6d3
Disposing TransientService - f76d6dad-8493-4401-ba75-5ba5d153a686
Disposing ScopedService - 81895945-1e7d-400f-a15b-fb853bd62de4
Disposing ScopedService - 8b965aa9-22b2-4061-88a4-ac3893d95a31
Disposing ScopedService - b436f1b0-ef28-4f35-8780-8dca3bc6365b
</div></code></code></pre>
<p>The next section is the actual first live render of <code>Index</code>.</p>
<p><img src="https://shauncurtis.github.io/posts/assets/Blazor-Services/Blazor-Component.png" alt="Blazor-Component"></p>
<ol>
<li>The singleton 7765 instance is the same throughout.</li>
<li>The Scoped 0d58 instance is the normal Hub Session instance.  It's used by both instances of the component.</li>
<li>There are two transient instances b258 and 5b7d.</li>
<li>There are two scoped instances 3a1b and d57a created by the &quot;Owning&quot; components.</li>
</ol>
<pre><code><code><div>New Instance ScopedService - 0d5824a1-cc6e-4df0-8f58-42f0c08c7313
New Instance TransientService - b2581dd9-abf4-4cdb-86e9-14cdf707550f
New Instance TransientService - 5b7d992c-0abc-4157-945f-eb8ab57e23a8
New Instance ScopedService - 3a1b5c67-92ec-42d7-b7f5-3454da4ba4ec
New Instance ScopedService - d57a6c8b-7464-48f3-b52c-45fe4f6bd53a
</div></code></code></pre>
<p>When we navigate to <code>Counter</code>:</p>
<ol>
<li>The two scoped instances 3a1b and d57a created by the &quot;Owning&quot; components are disposed.</li>
</ol>
<pre><code><code><div>Disposing ScopedService - 3a1b5c67-92ec-42d7-b7f5-3454da4ba4ec
Disposing ScopedService - d57a6c8b-7464-48f3-b52c-45fe4f6bd53a
</div></code></code></pre>
<p>When we navigate back to <code>Index</code></p>
<p><img src="https://shauncurtis.github.io/posts/assets/Blazor-Services/Blazor-Component-Routed.png" alt="Blazor-Component"></p>
<ol>
<li>The singleton 7765 instance is the same.</li>
<li>The Scoped 0d58 instance is the same normal Hub Session instance.</li>
<li>There are two new transient instances 4056 and affb.</li>
<li>There are two new scoped instances 2d11 and 36b9 created by the &quot;Owning&quot; components.</li>
</ol>
<pre><code><code><div>New Instance TransientService - 4056a2cf-b9ae-4067-8704-36724318a077
New Instance TransientService - affb563d-741a-49da-8747-080574f47eeb
New Instance ScopedService - 2d11acf4-1334-49c0-a64b-1a85bdfba506
New Instance ScopedService - 36b9370c-3663-489c-88cf-367b7ef401d3
</div></code></code></pre>
<p>Pretty much as you would expect.  But, what happened to those two Transient instances in the first render - b258 and 5b7d?  Why haven't they been disposed?  The same will be true of 4056 and affb on the second visit to <code>Index</code>.</p>
<p>The answer lies in how the Service Container deals with object instances that implement <code>IDisposable</code>.</p>
<p>Normal Transient service instances are created in the ciontainer, and the reference to the instance handed to the requester.  The container keeps no reference to the instance.  When the Instance goes out of scope with it's owner - normally the component being destroyed, the garbage collector also destroys the service instance: it has no references.</p>
<p><code>IDisposable</code> Transient services on the other hand need disposing.  Someone has to call <code>Dispose</code> on the instance, the garbage collector certainly doesn't!  So the DI container holds a reference to all <code>IDisposable</code> instances it creates.  When the requester now gets destroyed, the <code>IDisposable</code> Transient instance is still referenced by the DI container and thus not destroyed by the garbage collector.  So when do they get disposed.</p>
<p>To demonstrate I visited <code>Index</code> several times to build up a pot of Transient instances.  I then hit F5 to restart the SPA session.  At this point you will see this:  all the Transient instances being disposed.</p>
<pre><code><code><div>Disposing TransientService - 55db7e96-54fa-4ada-8a32-940fa3f7c506
Disposing TransientService - 38e99d73-95c5-4818-869f-bf530c1e3a14
Disposing TransientService - 4b92d54c-0c2b-4ebb-a610-6c4fdf44bea4
Disposing TransientService - 9b552c10-2d74-4eae-9245-8126ed38e1a2
Disposing TransientService - 61e6ab76-17ce-4b06-98ed-e5b4afbfffd3
Disposing TransientService - e04b744f-b7fd-4de8-bcb6-a90d2d494607
Disposing TransientService - 17635829-3200-4a5b-8adf-df61e5cc58a0
Disposing TransientService - 9c572895-2aca-4b84-ba2f-484cdf34c0d7
Disposing TransientService - d9c4d35b-da28-4b95-883c-2e40ef9a605d
Disposing TransientService - 92e2a5da-ea43-436e-8955-1958896e5555
Disposing TransientService - cabccee4-a5ac-4826-83cc-8125f3e84a1c
Disposing TransientService - 56b33353-ac58-4d5f-906f-e5a062c22352
Disposing TransientService - affb563d-741a-49da-8747-080574f47eeb
Disposing TransientService - 4056a2cf-b9ae-4067-8704-36724318a077
Disposing TransientService - 5b7d992c-0abc-4157-945f-eb8ab57e23a8
Disposing TransientService - b2581dd9-abf4-4cdb-86e9-14cdf707550f
</div></code></code></pre>
<p>Restarting the SPA session, or just killing it by navigating away from the SPA, closes the Hub session and with it the Hub Session DI container.  The clean up process when the hub session closes disposes of the DI container, which causes the DI container to call <code>Dispose</code> on all service instances in its &quot;Needs Disposing&quot; list.  This includes all the orphaned Transient instances.</p>
<p>You may not think this is too desperate, but it all depends on what those Transient Services do.</p>
<p>Imagine one that does a database lookup and creates a database context instance to do it.  And that instance is &quot;disposed&quot; through <code>IDisposable</code>.  You could soon have many &quot;open&quot; database sessions, eating up a lot of memory and database resources.</p>
<h3 id="solutions-to-the-transient-idisposable-issue">Solutions to the Transient <code>IDisposable</code> Issue</h3>
<ol>
<li>Use <code>using</code> to restrict further the scope of unmanaged resources to methods or sections of methods.</li>
<li>Only use such services in <code>OwningComponentBase</code> DI containers.  There's a little more work involved, but they are then disposed when the component is destroyed.</li>
</ol>
<p>Here's a slightly different implementation of <code>ServicesComponent</code>.  The <code>TransientService</code> instance is now running in the component DI container.</p>
<pre><code class="language-csharp"><div>@code {
    [<span class="hljs-meta">Parameter</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;

    [<span class="hljs-meta">Inject</span>] <span class="hljs-keyword">private</span> SingletonService? singletonService { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">Inject</span>] <span class="hljs-keyword">private</span> ScopedService? scopedService { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">private</span> TransientService? transientService { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">private</span> DateTime time = DateTime.Now;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnInitialized</span>(<span class="hljs-params"></span>)</span>
    {
        time = DateTime.Now;
        transientService = ScopedServices.GetRequiredService&lt;TransientService&gt;();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GetTime</span>(<span class="hljs-params"></span>)</span>
    =&gt; time = DateTime.Now;
}
</div></code></pre>
<h2 id="wrap-up">Wrap Up</h2>
<p>Hopefully you're a little more enlightened about Blazor and AspNetCore Dependancy Injection and Services.</p>

    

            </div>
        </div>
    </div>
</div>
<!-- end of Article Container -->


                </div>
                <!-- End of Main Content -->
            </div>
            <!-- Footer -->
            
<!-- Copyright -->
<footer class="sticky-footer bg-white">
    <div class="container my-auto">
        <div class="copyright text-center my-auto">
            
<span>Copyright &copy; Cold Elm Coders - 2022</span>

        </div>
    </div>
</footer>
<!-- end of copyright -->


            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
        
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


    </div>
    <!-- End of Page Wrapper -->
    <!-- Scripts -->
    
<!-- Scripts -->
<!-- Bootstrap core JavaScript-->
<script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="/assets/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="/assets/js/sb-admin-2.min.js"></script>


</body>
</html>
